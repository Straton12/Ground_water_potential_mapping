<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turkana Groundwater Analysis Dashboard | Water Resources Management</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.css" />
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/2.0.0/Control.FullScreen.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-measure@3.1.0/dist/leaflet-measure.css" />
    <style>
        /* Complete CSS Styles */
        :root {
            /* Colors - Professional Dashboard Theme */
            --primary: #1a365d;
            --primary-light: #2d3748;
            --secondary: #3182ce;
            --accent: #38a169;
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #f56565;
            --info: #9f7aea;
            --dark-blue: #2b6cb0;
            --light-blue: #90cdf4;
            --dark: #1a202c;
            --light: #f7fafc;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --border: var(--gray-200);

            /* Backgrounds */
            --bg-primary: #ffffff;
            --bg-secondary: var(--gray-50);
            --bg-sidebar: var(--primary);
            --bg-card: #ffffff;
            --bg-input: #ffffff;
            --bg-hover: var(--gray-100);
            --bg-active: var(--secondary);

            /* Typography */
            --font-xs: 0.625rem;
            --font-sm: 0.75rem;
            --font-base: 0.875rem;
            --font-md: 0.9375rem;
            --font-lg: 1rem;
            --font-xl: 1.125rem;
            --font-2xl: 1.25rem;
            --font-3xl: 1.5rem;
            --font-4xl: 1.75rem;

            /* Spacing - Compact Design */
            --space-0: 0rem;
            --space-1: 0.125rem;
            --space-2: 0.25rem;
            --space-3: 0.375rem;
            --space-4: 0.5rem;
            --space-5: 0.625rem;
            --space-6: 0.75rem;
            --space-7: 0.875rem;
            --space-8: 1rem;
            --space-9: 1.25rem;
            --space-10: 1.5rem;
            --space-12: 1.75rem;
            --space-14: 2rem;
            --space-16: 2.5rem;

            /* Design Elements */
            --radius-xs: 0.125rem;
            --radius-sm: 0.25rem;
            --radius: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;

            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1), 0 2px 2px -1px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

            --transition-fast: 150ms ease;
            --transition: 200ms ease;
            --transition-slow: 300ms ease;

            /* Z-index layers */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
        }

        /* Reset and Base Styles */
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 14px;
            height: 100%;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            font-size: var(--font-base);
            line-height: 1.5;
            font-weight: 400;
            color: var(--gray-800);
            background-color: var(--light);
            overflow-x: hidden;
            height: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        img,
        svg {
            max-width: 100%;
            height: auto;
            display: block;
        }

        /* Typography */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-weight: 600;
            line-height: 1.2;
            color: var(--gray-900);
            margin-bottom: var(--space-3);
        }

        h1 {
            font-size: var(--font-3xl);
        }

        h2 {
            font-size: var(--font-2xl);
        }

        h3 {
            font-size: var(--font-xl);
        }

        h4 {
            font-size: var(--font-lg);
        }

        h5 {
            font-size: var(--font-md);
        }

        h6 {
            font-size: var(--font-base);
        }

        p {
            margin-bottom: var(--space-3);
        }

        small,
        .text-sm {
            font-size: var(--font-sm);
        }

        .text-xs {
            font-size: var(--font-xs);
        }

        .text-lg {
            font-size: var(--font-lg);
        }

        .text-xl {
            font-size: var(--font-xl);
        }

        .font-light {
            font-weight: 300;
        }

        .font-normal {
            font-weight: 400;
        }

        .font-medium {
            font-weight: 500;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-bold {
            font-weight: 700;
        }

        .text-primary {
            color: var(--primary);
        }

        .text-secondary {
            color: var(--secondary);
        }

        .text-success {
            color: var(--success);
        }

        .text-warning {
            color: var(--warning);
        }

        .text-danger {
            color: var(--danger);
        }

        .text-info {
            color: var(--info);
        }

        .text-muted {
            color: var(--gray-500);
        }

        .text-white {
            color: white;
        }

        /* Layout */
        .dashboard-container {
            display: grid;
            grid-template-columns: 260px 1fr;
            min-height: 100vh;
            background: var(--gray-50);
        }

        /* Sidebar */
        .sidebar {
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: var(--space-6);
            position: fixed;
            width: 260px;
            height: 100vh;
            overflow-y: auto;
            z-index: var(--z-fixed);
            box-shadow: var(--shadow-lg);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            margin-bottom: var(--space-10);
            padding-bottom: var(--space-6);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header-icon {
            width: 36px;
            height: 36px;
            background: var(--accent);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-lg);
            color: white;
            flex-shrink: 0;
        }

        .sidebar-header-content h1 {
            font-size: var(--font-lg);
            font-weight: 600;
            line-height: 1.2;
            color: white;
            margin-bottom: var(--space-1);
        }

        .sidebar-header-content p {
            font-size: var(--font-xs);
            opacity: 0.7;
            color: rgba(255, 255, 255, 0.8);
            margin: 0;
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            margin-bottom: var(--space-10);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius);
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            transition: var(--transition);
            font-size: var(--font-base);
            font-weight: 500;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.12);
            color: white;
            transform: translateX(2px);
        }

        .nav-item.active {
            background: var(--secondary);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .nav-item i {
            width: 18px;
            text-align: center;
            font-size: var(--font-md);
        }

        .sidebar-section {
            margin-top: var(--space-8);
        }

        .sidebar-section h3 {
            font-size: var(--font-sm);
            font-weight: 600;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-4);
            padding-left: var(--space-4);
        }

        .sidebar-stats {
            background: rgba(255, 255, 255, 0.05);
            padding: var(--space-4);
            border-radius: var(--radius);
            margin-bottom: var(--space-6);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .sidebar-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-2) 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .sidebar-stat:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .sidebar-stat-label {
            font-size: var(--font-xs);
            color: rgba(255, 255, 255, 0.7);
        }

        .sidebar-stat-value {
            font-size: var(--font-base);
            font-weight: 600;
            color: white;
        }

        .sidebar-sources {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .sidebar-source {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-sm);
            color: rgba(255, 255, 255, 0.8);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .sidebar-source:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .sidebar-source i {
            color: var(--accent);
            font-size: var(--font-xs);
        }

        /* Main Content */
        .main-content {
            grid-column: 2;
            padding: var(--space-6);
            background: var(--gray-50);
            min-height: 100vh;
        }

        /* Top Bar */
        .top-bar {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-5) var(--space-8);
            margin-bottom: var(--space-6);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
        }

        .page-title {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .page-title-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--secondary), var(--dark-blue));
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: var(--font-lg);
        }

        .page-title-text h2 {
            font-size: var(--font-xl);
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-1);
            line-height: 1.2;
        }

        .page-title-text p {
            font-size: var(--font-sm);
            color: var(--gray-500);
            margin: 0;
        }

        .toolbar {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .last-updated {
            text-align: right;
        }

        .last-updated-label {
            font-size: var(--font-xs);
            color: var(--gray-500);
            margin-bottom: var(--space-1);
        }

        .last-updated-value {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--gray-700);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            display: flex;
            align-items: center;
            gap: var(--space-6);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            border-left: 4px solid transparent;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
            border-color: var(--secondary);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--secondary), transparent);
            opacity: 0;
            transition: var(--transition);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card.primary {
            border-left-color: var(--primary);
        }

        .stat-card.secondary {
            border-left-color: var(--secondary);
        }

        .stat-card.success {
            border-left-color: var(--success);
        }

        .stat-card.warning {
            border-left-color: var(--warning);
        }

        .stat-card.danger {
            border-left-color: var(--danger);
        }

        .stat-card.info {
            border-left-color: var(--info);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-xl);
            color: white;
            flex-shrink: 0;
            box-shadow: var(--shadow-sm);
        }

        .stat-card.primary .stat-icon {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
        }

        .stat-card.secondary .stat-icon {
            background: linear-gradient(135deg, var(--secondary), var(--dark-blue));
        }

        .stat-card.success .stat-icon {
            background: linear-gradient(135deg, var(--success), #2f855a);
        }

        .stat-card.warning .stat-icon {
            background: linear-gradient(135deg, var(--warning), #dd6b20);
        }

        .stat-card.danger .stat-icon {
            background: linear-gradient(135deg, var(--danger), #e53e3e);
        }

        .stat-card.info .stat-icon {
            background: linear-gradient(135deg, var(--info), #805ad5);
        }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            font-size: var(--font-2xl);
            font-weight: 700;
            line-height: 1;
            margin-bottom: var(--space-1);
            color: var(--gray-900);
        }

        .stat-label {
            font-size: var(--font-sm);
            color: var(--gray-500);
            font-weight: 500;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: var(--space-1);
            font-size: var(--font-xs);
            margin-top: var(--space-2);
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Tabs */
        .tabs-container {
            margin-bottom: var(--space-6);
        }

        .tabs {
            display: inline-flex;
            background: var(--gray-100);
            border-radius: var(--radius);
            padding: var(--space-2);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-xs);
        }

        .tab {
            padding: var(--space-3) var(--space-6);
            text-align: center;
            font-size: var(--font-base);
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            border-radius: calc(var(--radius) - var(--space-2));
            transition: var(--transition);
            white-space: nowrap;
            position: relative;
        }

        .tab:hover {
            color: var(--gray-900);
            background: var(--gray-200);
        }

        .tab.active {
            background: white;
            color: var(--secondary);
            box-shadow: var(--shadow-sm);
        }

        .tab-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--danger);
            color: white;
            font-size: var(--font-xs);
            padding: 1px 4px;
            border-radius: 10px;
            min-width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--space-6);
            margin-bottom: var(--space-6);
        }

        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Map Container */
        .map-container {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            height: 600px;
            position: relative;
            border: 1px solid var(--border);
        }

        #main-map {
            width: 100%;
            height: 100%;
            border-radius: var(--radius-lg);
        }

        .leaflet-container {
            font-family: inherit;
            font-size: var(--font-sm);
        }

        /* Map Controls Container */
        .map-controls-container {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            box-shadow: var(--shadow);
            height: 600px;
            overflow-y: auto;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: var(--space-8);
        }

        .map-controls-container::-webkit-scrollbar {
            width: 6px;
        }

        .map-controls-container::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 3px;
        }

        .map-controls-container::-webkit-scrollbar-thumb {
            background: var(--gray-400);
            border-radius: 3px;
        }

        /* Control Sections */
        .control-section {
            margin-bottom: 0;
        }

        .control-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-3);
            border-bottom: 1px solid var(--border);
        }

        .control-section-header h4 {
            font-size: var(--font-md);
            font-weight: 600;
            color: var(--gray-900);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .control-section-header h4 i {
            color: var(--secondary);
            font-size: var(--font-base);
        }

        .control-section-header .btn-icon {
            padding: var(--space-2);
            border-radius: var(--radius);
        }

        /* Filter Controls */
        .filter-group {
            margin-bottom: var(--space-5);
        }

        .filter-group:last-child {
            margin-bottom: 0;
        }

        .filter-group label {
            display: block;
            font-size: var(--font-sm);
            font-weight: 500;
            margin-bottom: var(--space-2);
            color: var(--gray-700);
        }

        .filter-group .help-text {
            font-size: var(--font-xs);
            color: var(--gray-500);
            margin-top: var(--space-1);
            margin-bottom: var(--space-3);
        }

        .filter-select,
        .filter-input,
        .filter-textarea {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: var(--font-base);
            background: var(--bg-input);
            color: var(--gray-800);
            transition: var(--transition);
            font-family: inherit;
        }

        .filter-select:hover,
        .filter-input:hover,
        .filter-textarea:hover {
            border-color: var(--gray-400);
        }

        .filter-select:focus,
        .filter-input:focus,
        .filter-textarea:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
        }

        .filter-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }

        .filter-range {
            width: 100%;
            height: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--gray-200);
            border-radius: 2px;
            outline: none;
            margin: var(--space-4) 0;
        }

        .filter-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--secondary);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: var(--shadow-sm);
        }

        .filter-range-value {
            text-align: center;
            font-size: var(--font-sm);
            color: var(--gray-600);
            margin-top: var(--space-2);
        }

        .filter-checkboxes,
        .filter-radios {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .filter-checkbox,
        .filter-radio {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            cursor: pointer;
            font-size: var(--font-base);
            color: var(--gray-700);
            user-select: none;
        }

        .filter-checkbox input[type="checkbox"],
        .filter-radio input[type="radio"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: var(--secondary);
        }

        .filter-checkbox-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            display: inline-block;
            margin-right: var(--space-2);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        /* Layer Controls */
        .layer-controls {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .layer-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-3) var(--space-4);
            background: var(--bg-secondary);
            border-radius: var(--radius);
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .layer-control:hover {
            background: var(--bg-hover);
            border-color: var(--border);
        }

        .layer-control.active {
            background: white;
            border-color: var(--secondary);
            box-shadow: var(--shadow-xs);
        }

        .layer-info {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .layer-icon {
            width: 24px;
            height: 24px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-sm);
            color: var(--gray-600);
            background: var(--gray-100);
        }

        .layer-details {
            display: flex;
            flex-direction: column;
            gap: 1px;
        }

        .layer-name {
            font-size: var(--font-base);
            font-weight: 500;
            color: var(--gray-800);
        }

        .layer-description {
            font-size: var(--font-xs);
            color: var(--gray-500);
        }

        .layer-toggle {
            position: relative;
            width: 36px;
            height: 20px;
        }

        .layer-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .layer-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray-300);
            transition: var(--transition);
            border-radius: 34px;
        }

        .layer-toggle-slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        .layer-toggle input:checked+.layer-toggle-slider {
            background-color: var(--secondary);
        }

        .layer-toggle input:checked+.layer-toggle-slider:before {
            transform: translateX(16px);
        }

        /* Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-5);
            border-radius: var(--radius);
            font-size: var(--font-base);
            font-weight: 500;
            border: 1px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            font-family: inherit;
            line-height: 1;
            white-space: nowrap;
            user-select: none;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--dark-blue);
            border-color: var(--dark-blue);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
            border-color: var(--border);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--gray-200);
            color: var(--gray-800);
            border-color: var(--gray-300);
        }

        .btn-success {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
            border-color: var(--warning);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--gray-600);
        }

        .btn-outline:hover:not(:disabled) {
            border-color: var(--secondary);
            color: var(--secondary);
            background: rgba(49, 130, 206, 0.05);
        }

        .btn-sm {
            padding: var(--space-2) var(--space-3);
            font-size: var(--font-sm);
        }

        .btn-lg {
            padding: var(--space-4) var(--space-6);
            font-size: var(--font-lg);
        }

        .btn-icon {
            padding: var(--space-3);
            width: 36px;
            height: 36px;
        }

        .btn-icon.btn-sm {
            padding: var(--space-2);
            width: 30px;
            height: 30px;
        }

        .btn-group {
            display: flex;
            gap: var(--space-2);
        }

        .btn-group .btn {
            border-radius: 0;
        }

        .btn-group .btn:first-child {
            border-top-left-radius: var(--radius);
            border-bottom-left-radius: var(--radius);
        }

        .btn-group .btn:last-child {
            border-top-right-radius: var(--radius);
            border-bottom-right-radius: var(--radius);
        }

        /* Map Overlay Controls */
        .map-overlay-controls {
            position: absolute;
            top: var(--space-4);
            right: var(--space-4);
            z-index: var(--z-fixed);
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .map-btn {
            width: 36px;
            height: 36px;
            border-radius: var(--radius);
            background: white;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            color: var(--gray-700);
        }

        .map-btn:hover {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .map-btn.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        /* Legend */
        .map-legend {
            position: absolute;
            bottom: var(--space-4);
            right: var(--space-4);
            background: white;
            border-radius: var(--radius);
            padding: var(--space-4);
            box-shadow: var(--shadow-lg);
            z-index: var(--z-fixed);
            width: 260px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border);
        }

        .legend-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-3);
            border-bottom: 1px solid var(--border);
        }

        .legend-header h5 {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--gray-900);
            margin: 0;
        }

        .legend-content {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-sm);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: var(--radius-sm);
            flex-shrink: 0;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .legend-gradient {
            height: 16px;
            flex: 1;
            border-radius: var(--radius-sm);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .legend-labels {
            display: flex;
            justify-content: space-between;
            font-size: var(--font-xs);
            color: var(--gray-600);
            margin-top: var(--space-1);
        }

        /* Loading Overlay */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            border-radius: var(--radius-lg);
            backdrop-filter: blur(4px);
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--gray-200);
            border-top: 3px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: var(--space-4);
        }

        .loading-text {
            font-size: var(--font-md);
            font-weight: 500;
            color: var(--gray-700);
            text-align: center;
            max-width: 300px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: var(--gray-200);
            border-radius: 2px;
            margin-top: var(--space-4);
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--accent));
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Info Panel */
        .info-panel {
            position: absolute;
            top: var(--space-4);
            left: var(--space-4);
            background: white;
            border-radius: var(--radius);
            padding: var(--space-4);
            box-shadow: var(--shadow-lg);
            z-index: var(--z-fixed);
            width: 320px;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid var(--border);
        }

        .info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-3);
            border-bottom: 1px solid var(--border);
        }

        .info-header h5 {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--gray-900);
            margin: 0;
        }

        .info-content {
            padding: var(--space-2) 0;
        }

        .info-section {
            margin-bottom: var(--space-4);
        }

        .info-section:last-child {
            margin-bottom: 0;
        }

        .info-section h6 {
            font-size: var(--font-sm);
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: var(--space-3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-3);
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .info-label {
            font-size: var(--font-xs);
            color: var(--gray-500);
            font-weight: 500;
        }

        .info-value {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--gray-900);
        }

        .info-value-large {
            font-size: var(--font-xl);
            font-weight: 700;
        }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .chart-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
        }

        .chart-header h4 {
            font-size: var(--font-md);
            font-weight: 600;
            color: var(--gray-900);
            margin: 0;
        }

        .chart-container {
            height: 240px;
            position: relative;
        }

        /* Data Tables */
        .data-table-container {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            margin-bottom: var(--space-6);
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--font-sm);
        }

        .data-table th {
            text-align: left;
            padding: var(--space-3) var(--space-4);
            font-weight: 600;
            color: var(--gray-700);
            background: var(--gray-50);
            border-bottom: 2px solid var(--border);
            white-space: nowrap;
        }

        .data-table td {
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--border);
            color: var(--gray-700);
        }

        .data-table tr:hover {
            background: var(--gray-50);
        }

        .data-table tr.selected {
            background: rgba(49, 130, 206, 0.05);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            padding: var(--space-6);
            backdrop-filter: blur(4px);
        }

        .modal {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-8);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
        }

        .modal-header h4 {
            font-size: var(--font-xl);
            font-weight: 600;
            color: var(--gray-900);
            margin: 0;
        }

        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            position: absolute;
            z-index: var(--z-tooltip);
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gray-900);
            color: white;
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius);
            font-size: var(--font-xs);
            white-space: nowrap;
            opacity: 0;
            transition: opacity var(--transition);
            pointer-events: none;
        }

        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 4px;
            border-style: solid;
            border-color: var(--gray-900) transparent transparent transparent;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: var(--space-6);
            right: var(--space-6);
            padding: var(--space-4) var(--space-6);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: var(--z-popover);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            max-width: 400px;
            animation: slideIn 0.3s ease;
            border-left: 4px solid;
        }

        .notification-success {
            background: var(--success);
            color: white;
            border-left-color: #2f855a;
        }

        .notification-error {
            background: var(--danger);
            color: white;
            border-left-color: #e53e3e;
        }

        .notification-warning {
            background: var(--warning);
            color: white;
            border-left-color: #dd6b20;
        }

        .notification-info {
            background: var(--secondary);
            color: white;
            border-left-color: var(--dark-blue);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-center {
            justify-content: center;
        }

        .gap-1 {
            gap: var(--space-1);
        }

        .gap-2 {
            gap: var(--space-2);
        }

        .gap-3 {
            gap: var(--space-3);
        }

        .gap-4 {
            gap: var(--space-4);
        }

        .w-full {
            width: 100%;
        }

        .h-full {
            height: 100%;
        }

        .m-0 {
            margin: 0;
        }

        .mt-1 {
            margin-top: var(--space-1);
        }

        .mt-2 {
            margin-top: var(--space-2);
        }

        .mt-3 {
            margin-top: var(--space-3);
        }

        .mt-4 {
            margin-top: var(--space-4);
        }

        .mb-1 {
            margin-bottom: var(--space-1);
        }

        .mb-2 {
            margin-bottom: var(--space-2);
        }

        .mb-3 {
            margin-bottom: var(--space-3);
        }

        .mb-4 {
            margin-bottom: var(--space-4);
        }

        .p-0 {
            padding: 0;
        }

        .p-2 {
            padding: var(--space-2);
        }

        .p-3 {
            padding: var(--space-3);
        }

        .p-4 {
            padding: var(--space-4);
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Analysis Cards */
        .analysis-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .analysis-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .analysis-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--secondary);
        }

        .analysis-card-header {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }

        .analysis-card-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-xl);
            color: white;
            flex-shrink: 0;
        }

        .analysis-card-title h4 {
            font-size: var(--font-md);
            font-weight: 600;
            color: var(--gray-900);
            margin: 0;
        }

        .analysis-card-title p {
            font-size: var(--font-sm);
            color: var(--gray-500);
            margin: 0;
        }

        .analysis-card-content {
            margin-bottom: var(--space-4);
        }

        .analysis-card-content p {
            font-size: var(--font-base);
            color: var(--gray-600);
            line-height: 1.6;
        }

        .analysis-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: var(--space-4);
            border-top: 1px solid var(--border);
        }

        .analysis-card-tags {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        .analysis-tag {
            background: var(--gray-100);
            color: var(--gray-600);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            font-size: var(--font-xs);
            font-weight: 500;
        }

        .analysis-tag.primary {
            background: var(--secondary);
            color: white;
        }

        .analysis-tag.success {
            background: var(--success);
            color: white;
        }

        .analysis-tag.warning {
            background: var(--warning);
            color: white;
        }

        .analysis-tag.danger {
            background: var(--danger);
            color: white;
        }

        /* Detailed Analysis Section */
        .detailed-analysis-section {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--space-8);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            margin-bottom: var(--space-6);
        }

        .analysis-section-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-8);
            padding-bottom: var(--space-6);
            border-bottom: 2px solid var(--border);
        }

        .analysis-section-title h3 {
            font-size: var(--font-xl);
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-2);
        }

        .analysis-section-title p {
            font-size: var(--font-base);
            color: var(--gray-500);
            max-width: 600px;
        }

        .analysis-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .analysis-metric {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-6);
            text-align: center;
        }

        .analysis-metric-value {
            font-size: var(--font-3xl);
            font-weight: 700;
            color: var(--primary);
            margin-bottom: var(--space-2);
        }

        .analysis-metric-label {
            font-size: var(--font-base);
            color: var(--gray-600);
            margin-bottom: var(--space-2);
        }

        .analysis-metric-description {
            font-size: var(--font-sm);
            color: var(--gray-500);
        }

        /* Water Quality Analysis */
        .water-quality-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .quality-indicator {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .quality-indicator-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-lg);
            color: white;
            flex-shrink: 0;
        }

        .quality-indicator.good .quality-indicator-icon {
            background: var(--success);
        }

        .quality-indicator.fair .quality-indicator-icon {
            background: var(--warning);
        }

        .quality-indicator.poor .quality-indicator-icon {
            background: var(--danger);
        }

        .quality-indicator-content h5 {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-1);
        }

        .quality-indicator-content p {
            font-size: var(--font-sm);
            color: var(--gray-500);
            margin: 0;
        }

        /* Predictive Models */
        .model-container {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .model-parameters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }

        .model-parameter {
            background: white;
            border-radius: var(--radius);
            padding: var(--space-4);
            border: 1px solid var(--border);
        }

        .model-parameter-label {
            font-size: var(--font-sm);
            font-weight: 500;
            color: var(--gray-600);
            margin-bottom: var(--space-2);
        }

        .model-parameter-value {
            font-size: var(--font-lg);
            font-weight: 600;
            color: var(--gray-900);
        }

        /* Gap Analysis Results */
        .gap-results {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-6);
        }

        .gap-category {
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--border);
        }

        .gap-category:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .gap-category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-2);
        }

        .gap-category-title {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--gray-900);
        }

        .gap-category-severity {
            font-size: var(--font-sm);
            font-weight: 500;
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-sm);
        }

        .gap-category-severity.high {
            background: var(--danger);
            color: white;
        }

        .gap-category-severity.medium {
            background: var(--warning);
            color: white;
        }

        .gap-category-severity.low {
            background: var(--success);
            color: white;
        }

        .gap-category-description {
            font-size: var(--font-sm);
            color: var(--gray-600);
            margin-bottom: var(--space-3);
        }

        .gap-category-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-3);
        }

        .gap-stat {
            text-align: center;
        }

        .gap-stat-value {
            font-size: var(--font-xl);
            font-weight: 700;
            color: var(--primary);
            margin-bottom: var(--space-1);
        }

        .gap-stat-label {
            font-size: var(--font-sm);
            color: var(--gray-500);
        }

        /* Page Content */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Fullscreen control styles */
        .leaflet-control-fullscreen a {
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCIgd2lkdGg9IjI0cHgiIGhlaWdodD0iMjRweCI+PHBhdGggZD0iTTE0IDE0SDQwdjI2SDI0VjQwSDQwVjI0aC0yNnYxMk0yNCAyNEgwdjI2aDE0VjQwSDBWMTRoMjZ2MTB6IiBmaWxsPSIjMzMzMzMzIi8+PC9zdmc+');
            background-position: 50% 50%;
            background-repeat: no-repeat;
            display: block;
        }

        .leaflet-control-fullscreen a:hover {
            background-color: #f4f4f4;
        }

        .leaflet-touch .leaflet-control-fullscreen a {
            background-position: 50% 50%;
        }

        .leaflet-fullscreen-on .leaflet-control-fullscreen a {
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCIgd2lkdGg9IjI0cHgiIGhlaWdodD0iMjRweCI+PHBhdGggZD0iTTE0IDI0SDBWMTRoMjZWMGgxNHYyNkgyNHYtMnpNMjQgMjRoMTB2MTBIMTQWMzRoMTB6IiBmaWxsPSIjMzMzMzMzIi8+PC9zdmc+');
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
                max-height: 300px;
            }

            .main-content {
                grid-column: 1;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .map-container {
                height: 500px;
            }

            .map-controls-container {
                height: auto;
            }

            .analysis-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .analysis-cards {
                grid-template-columns: 1fr;
            }

            .top-bar {
                flex-direction: column;
                gap: var(--space-4);
                align-items: stretch;
                padding: var(--space-4);
            }

            .page-title {
                flex-direction: column;
                text-align: center;
                gap: var(--space-3);
            }

            .toolbar {
                justify-content: center;
            }

            .map-overlay-controls {
                top: auto;
                bottom: var(--space-4);
                right: var(--space-4);
                flex-direction: row;
            }

            .map-legend {
                left: var(--space-4);
                right: var(--space-4);
                width: auto;
            }

            .info-panel {
                left: var(--space-4);
                right: var(--space-4);
                width: auto;
            }

            .analysis-metrics {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab {
                flex: 1;
                min-width: 120px;
            }

            .map-container {
                height: 400px;
            }

            .btn-group {
                flex-wrap: wrap;
            }
        }

        /* Print Styles */
        @media print {

            .sidebar,
            .map-overlay-controls,
            .map-legend,
            .info-panel,
            .top-bar .toolbar {
                display: none !important;
            }

            .dashboard-container {
                grid-template-columns: 1fr;
            }

            .main-content {
                padding: 0;
            }

            .map-container {
                height: 500px;
                page-break-inside: avoid;
            }

            .stats-grid,
            .charts-grid {
                page-break-inside: avoid;
            }
        }

        /* Analysis Matrix */
        .analysis-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .matrix-item {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-4);
            text-align: center;
        }

        .matrix-value {
            font-size: var(--font-2xl);
            font-weight: 700;
            color: var(--primary);
            margin-bottom: var(--space-2);
        }

        .matrix-label {
            font-size: var(--font-sm);
            color: var(--gray-600);
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: var(--space-8);
            margin-bottom: var(--space-6);
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 16px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--gray-300);
        }

        .timeline-item {
            position: relative;
            margin-bottom: var(--space-6);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 6px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--secondary);
            border: 2px solid white;
            box-shadow: 0 0 0 2px var(--secondary);
        }

        .timeline-date {
            font-size: var(--font-sm);
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: var(--space-2);
        }

        .timeline-content {
            background: white;
            border-radius: var(--radius);
            padding: var(--space-4);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }

        /* Comparison Charts */
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .comparison-chart {
            height: 300px;
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-4);
        }

        /* Alert System */
        .alert-system {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .alert {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-4);
            border-radius: var(--radius);
            margin-bottom: var(--space-3);
            background: white;
            border-left: 4px solid;
        }

        .alert:last-child {
            margin-bottom: 0;
        }

        .alert.critical {
            border-left-color: var(--danger);
            background: rgba(245, 101, 101, 0.05);
        }

        .alert.warning {
            border-left-color: var(--warning);
            background: rgba(237, 137, 54, 0.05);
        }

        .alert.info {
            border-left-color: var(--info);
            background: rgba(159, 122, 234, 0.05);
        }

        .alert-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-base);
            color: white;
            flex-shrink: 0;
        }

        .alert.critical .alert-icon {
            background: var(--danger);
        }

        .alert.warning .alert-icon {
            background: var(--warning);
        }

        .alert.info .alert-icon {
            background: var(--info);
        }

        .alert-content h5 {
            font-size: var(--font-base);
            font-weight: 600;
            margin-bottom: var(--space-1);
        }

        .alert-content p {
            font-size: var(--font-sm);
            color: var(--gray-600);
            margin: 0;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-header-icon">
                    <i class="fas fa-water"></i>
                </div>
                <div class="sidebar-header-content">
                    <h1>Turkana Groundwater</h1>
                    <p>Analysis Dashboard v4.0</p>
                </div>
            </div>

            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-page="borehole-analysis">
                    <i class="fas fa-chart-bar"></i>
                    <span>Borehole Analysis</span>
                </a>
                <a href="#" class="nav-item" data-page="geospatial-analysis">
                    <i class="fas fa-map-marked-alt"></i>
                    <span>Geospatial Analysis</span>
                </a>
                <a href="#" class="nav-item" data-page="hydrogeological-analysis">
                    <i class="fas fa-layer-group"></i>
                    <span>Hydrogeological Analysis</span>
                </a>
                <a href="#" class="nav-item" data-page="water-quality">
                    <i class="fas fa-flask"></i>
                    <span>Water Quality Analysis</span>
                </a>
                <a href="#" class="nav-item" data-page="predictive-modeling">
                    <i class="fas fa-crystal-ball"></i>
                    <span>Predictive Modeling</span>
                </a>
                <a href="#" class="nav-item" data-page="gap-analysis">
                    <i class="fas fa-calculator"></i>
                    <span>Gap Analysis</span>
                </a>
                <a href="#" class="nav-item" data-page="sustainability">
                    <i class="fas fa-leaf"></i>
                    <span>Sustainability</span>
                </a>
                <a href="#" class="nav-item" data-page="reports">
                    <i class="fas fa-file-export"></i>
                    <span>Reports</span>
                </a>
                <a href="#" class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </nav>

            <div class="sidebar-section">
                <h3>Quick Statistics</h3>
                <div class="sidebar-stats">
                    <div class="sidebar-stat">
                        <span class="sidebar-stat-label">Total Boreholes:</span>
                        <span class="sidebar-stat-value" id="sidebar-total">0</span>
                    </div>
                    <div class="sidebar-stat">
                        <span class="sidebar-stat-label">Functional:</span>
                        <span class="sidebar-stat-value text-success" id="sidebar-functional">0%</span>
                    </div>
                    <div class="sidebar-stat">
                        <span class="sidebar-stat-label">Avg. Yield:</span>
                        <span class="sidebar-stat-value" id="sidebar-yield">0 m/hr</span>
                    </div>
                    <div class="sidebar-stat">
                        <span class="sidebar-stat-label">Water Table Depth:</span>
                        <span class="sidebar-stat-value" id="sidebar-depth">0 m</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>Data Sources</h3>
                <div class="sidebar-sources">
                    <div class="sidebar-source">
                        <i class="fas fa-check-circle"></i>
                        <span>Turkana County Data</span>
                    </div>
                    <div class="sidebar-source">
                        <i class="fas fa-check-circle"></i>
                        <span>Ministry of Water</span>
                    </div>
                    <div class="sidebar-source">
                        <i class="fas fa-check-circle"></i>
                        <span>Hydrogeological Surveys</span>
                    </div>
                    <div class="sidebar-source">
                        <i class="fas fa-check-circle"></i>
                        <span>Satellite Data</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="page-title">
                    <div class="page-title-icon">
                        <i class="fas fa-tint"></i>
                    </div>
                    <div class="page-title-text">
                        <h2 id="page-title">Groundwater Resources Analysis</h2>
                        <p id="page-description">Comprehensive monitoring and analysis of groundwater resources in
                            Turkana County</p>
                    </div>
                </div>

                <div class="toolbar">
                    <div class="last-updated">
                        <div class="last-updated-label">Last Updated</div>
                        <div class="last-updated-value" id="last-updated">Loading...</div>
                    </div>
                    <button class="btn btn-primary" id="refresh-data">
                        <i class="fas fa-sync-alt"></i>
                        Refresh Data
                    </button>
                    <button class="btn btn-outline" id="export-dashboard">
                        <i class="fas fa-download"></i>
                        Export
                    </button>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page-content active">
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card primary">
                        <div class="stat-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="total-boreholes">0</div>
                            <div class="stat-label">Total Boreholes</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>+2.4% from last month</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card success">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="functional-rate">0%</div>
                            <div class="stat-label">Functional Rate</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>+5.2% improvement</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card secondary">
                        <div class="stat-icon">
                            <i class="fas fa-water"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="avg-yield">0</div>
                            <div class="stat-label">Avg Yield (m/hr)</div>
                            <div class="stat-change negative">
                                <i class="fas fa-arrow-down"></i>
                                <span>-1.3% from last year</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card warning">
                        <div class="stat-icon">
                            <i class="fas fa-ruler-vertical"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="avg-depth">0</div>
                            <div class="stat-label">Avg Depth to Water (m)</div>
                            <div class="stat-change negative">
                                <i class="fas fa-arrow-up"></i>
                                <span>Water table dropping</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card info">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="people-served">0</div>
                            <div class="stat-label">People Served</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>+3.8% population growth</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card danger">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="critical-boreholes">0</div>
                            <div class="stat-label">Critical Boreholes</div>
                            <div class="stat-change negative">
                                <i class="fas fa-arrow-up"></i>
                                <span>+3 needs repair</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="tabs-container">
                    <div class="tabs" id="main-tabs">
                        <div class="tab active" data-tab="map">
                            <i class="fas fa-map"></i>
                            Interactive Map
                        </div>
                        <div class="tab" data-tab="analysis">
                            <i class="fas fa-chart-line"></i>
                            Analysis Tools
                        </div>
                        <div class="tab" data-tab="layers">
                            <i class="fas fa-layer-group"></i>
                            Data Layers
                        </div>
                        <div class="tab" data-tab="reports">
                            <i class="fas fa-file-alt"></i>
                            Reports
                            <span class="tab-badge">3</span>
                        </div>
                        <div class="tab" data-tab="predictive">
                            <i class="fas fa-crystal-ball"></i>
                            Predictive Analysis
                        </div>
                    </div>
                </div>

                <!-- Map Tab Content -->
                <div id="map-tab" class="tab-content active">
                    <div class="dashboard-grid">
                        <!-- Map Container -->
                        <div class="map-container">
                            <div id="main-map"></div>

                            <!-- Loading Overlay -->
                            <div class="loading-overlay" id="map-loading">
                                <div class="loading-spinner"></div>
                                <div class="loading-text" id="loading-text">Loading groundwater data...</div>
                                <div class="loading-progress">
                                    <div class="loading-progress-bar" id="loading-progress"></div>
                                </div>
                            </div>

                            <!-- Map Overlay Controls -->
                            <div class="map-overlay-controls">
                                <button class="map-btn tooltip" id="reset-view" data-tooltip="Reset View">
                                    <i class="fas fa-globe-africa"></i>
                                </button>
                                <button class="map-btn tooltip" id="locate-me" data-tooltip="My Location">
                                    <i class="fas fa-location-crosshairs"></i>
                                </button>
                                <button class="map-btn tooltip" id="measure-tool" data-tooltip="Measure Distance">
                                    <i class="fas fa-ruler"></i>
                                </button>
                                <button class="map-btn tooltip" id="add-marker" data-tooltip="Add Marker">
                                    <i class="fas fa-map-pin"></i>
                                </button>
                                <button class="map-btn tooltip" id="draw-tool" data-tooltip="Draw Area">
                                    <i class="fas fa-draw-polygon"></i>
                                </button>
                                <button class="map-btn tooltip" id="fullscreen" data-tooltip="Full Screen">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button class="map-btn tooltip" id="print-map" data-tooltip="Print Map">
                                    <i class="fas fa-print"></i>
                                </button>
                            </div>

                            <!-- Legend -->
                            <div class="map-legend" id="map-legend">
                                <div class="legend-header">
                                    <h5>Map Legend</h5>
                                    <button class="btn btn-sm btn-icon" id="toggle-legend">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="legend-content" id="legend-content">
                                    <!-- Legend items will be populated dynamically -->
                                </div>
                            </div>

                            <!-- Info Panel -->
                            <div class="info-panel" id="info-panel" style="display: none;">
                                <div class="info-header">
                                    <h5 id="panel-title">Borehole Details</h5>
                                    <button class="btn btn-sm btn-icon" id="close-panel">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="info-content" id="panel-content">
                                    <!-- Panel content will be populated dynamically -->
                                </div>
                            </div>
                        </div>

                        <!-- Map Controls -->
                        <div class="map-controls-container">
                            <!-- Data Filters Section -->
                            <div class="control-section">
                                <div class="control-section-header">
                                    <h4><i class="fas fa-filter"></i> Data Filters</h4>
                                    <button class="btn btn-sm btn-outline btn-icon" id="clear-filters">
                                        <i class="fas fa-redo"></i>
                                    </button>
                                </div>

                                <!-- In the Data Filters Section, replace the first filter group -->
                                <div class="filter-group">
                                    <label for="admin-level-select">Administrative Level</label>
                                    <select id="admin-level-select" class="filter-select">
                                        <option value="county">County Level</option>
                                        <option value="subcounty">Sub-County Level</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group">
                                    <label for="admin-unit-filter">Administrative Unit</label>
                                    <select id="admin-unit-filter" class="filter-select">
                                        <option value="all">All Turkana County</option>
                                        <!-- Options will be populated dynamically -->
                                    </select>
                                </div>

                                <div class="filter-group">
                                    <label>Borehole Status</label>
                                    <div class="filter-checkboxes">
                                        <label class="filter-checkbox">
                                            <input type="checkbox" name="status" value="functional" checked>
                                            <span class="filter-checkbox-color"
                                                style="background-color: #48bb78;"></span>
                                            Functional
                                        </label>
                                        <label class="filter-checkbox">
                                            <input type="checkbox" name="status" value="non-functional" checked>
                                            <span class="filter-checkbox-color"
                                                style="background-color: #f56565;"></span>
                                            Non-Functional
                                        </label>
                                        <label class="filter-checkbox">
                                            <input type="checkbox" name="status" value="needs-repair" checked>
                                            <span class="filter-checkbox-color"
                                                style="background-color: #ed8936;"></span>
                                            Needs Repair
                                        </label>
                                        <label class="filter-checkbox">
                                            <input type="checkbox" name="status" value="abandoned" checked>
                                            <span class="filter-checkbox-color"
                                                style="background-color: #a0aec0;"></span>
                                            Abandoned
                                        </label>
                                        <label class="filter-checkbox">
                                            <input type="checkbox" name="status" value="dry" checked>
                                            <span class="filter-checkbox-color"
                                                style="background-color: #4a5568;"></span>
                                            Dry
                                        </label>
                                    </div>
                                </div>

                                <div class="filter-group">
                                    <label for="yield-filter">Yield Range (m/hr)</label>
                                    <input type="range" id="yield-filter" class="filter-range" min="0" max="50"
                                        value="50" step="1">
                                    <div class="filter-range-value" id="yield-value">0 - 50 m/hr</div>
                                </div>

                                <div class="filter-group">
                                    <label for="depth-filter">Depth Range (m)</label>
                                    <input type="range" id="depth-filter" class="filter-range" min="0" max="200"
                                        value="200" step="1">
                                    <div class="filter-range-value" id="depth-value">0 - 200 m</div>
                                </div>

                                <div class="filter-group">
                                    <label for="year-filter">Completion Year</label>
                                    <select id="year-filter" class="filter-select">
                                        <option value="all">All Years</option>
                                        <option value="recent">Last 5 Years</option>
                                        <option value="medium">5-10 Years Ago</option>
                                        <option value="old">Over 10 Years</option>
                                    </select>
                                </div>

                                <div class="btn-group w-full">
                                    <button class="btn btn-primary flex-1" id="apply-filters">
                                        <i class="fas fa-check"></i>
                                        Apply Filters
                                    </button>
                                    <button class="btn btn-outline" id="reset-filters">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Map Layers Section -->
                            <div class="control-section">
                                <div class="control-section-header">
                                    <h4><i class="fas fa-layer-group"></i> Map Layers</h4>
                                    <button class="btn btn-sm btn-outline btn-icon" id="toggle-all-layers">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>

                                <div class="layer-controls">
                                    <div class="layer-control active" data-layer="boreholes">
                                        <div class="layer-info">
                                            <div class="layer-icon" style="background-color: #3182ce;">
                                                <i class="fas fa-water"></i>
                                            </div>
                                            <div class="layer-details">
                                                <div class="layer-name">Boreholes</div>
                                                <div class="layer-description">Water points with data</div>
                                            </div>
                                        </div>
                                        <label class="layer-toggle">
                                            <input type="checkbox" checked>
                                            <span class="layer-toggle-slider"></span>
                                        </label>
                                    </div>

                                    <div class="layer-control" data-layer="suitability">
                                        <div class="layer-info">
                                            <div class="layer-icon" style="background-color: #38a169;">
                                                <i class="fas fa-layer-group"></i>
                                            </div>
                                            <div class="layer-details">
                                                <div class="layer-name">Suitability Map</div>
                                                <div class="layer-description">Groundwater potential</div>
                                            </div>
                                        </div>
                                        <label class="layer-toggle">
                                            <input type="checkbox">
                                            <span class="layer-toggle-slider"></span>
                                        </label>
                                    </div>

                                    <div class="layer-control" data-layer="population">
                                        <div class="layer-info">
                                            <div class="layer-icon" style="background-color: #9f7aea;">
                                                <i class="fas fa-users"></i>
                                            </div>
                                            <div class="layer-details">
                                                <div class="layer-name">Population Density</div>
                                                <div class="layer-description">People per km</div>
                                            </div>
                                        </div>
                                        <label class="layer-toggle">
                                            <input type="checkbox">
                                            <span class="layer-toggle-slider"></span>
                                        </label>
                                    </div>

                                    <div class="layer-control" data-layer="infrastructure">
                                        <div class="layer-info">
                                            <div class="layer-icon" style="background-color: #ed8936;">
                                                <i class="fas fa-road"></i>
                                            </div>
                                            <div class="layer-details">
                                                <div class="layer-name">Infrastructure</div>
                                                <div class="layer-description">Roads & settlements</div>
                                            </div>
                                        </div>
                                        <label class="layer-toggle">
                                            <input type="checkbox">
                                            <span class="layer-toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Base Map Selection -->
                            <div class="control-section">
                                <div class="control-section-header">
                                    <h4><i class="fas fa-palette"></i> Base Map</h4>
                                </div>

                                <div class="btn-group w-full">
                                    <button class="btn btn-outline active" data-basemap="osm">
                                        <i class="fas fa-map"></i>
                                        Street
                                    </button>
                                    <button class="btn btn-outline" data-basemap="satellite">
                                        <i class="fas fa-satellite"></i>
                                        Satellite
                                    </button>
                                    <button class="btn btn-outline" data-basemap="topo">
                                        <i class="fas fa-mountain"></i>
                                        Topo
                                    </button>
                                    <button class="btn btn-outline" data-basemap="light">
                                        <i class="fas fa-sun"></i>
                                        Light
                                    </button>
                                    <button class="btn btn-outline" data-basemap="dark">
                                        <i class="fas fa-moon"></i>
                                        Dark
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Grid -->
                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h4>Borehole Status Distribution</h4>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline active" data-chart-type="pie">Pie</button>
                                    <button class="btn btn-sm btn-outline" data-chart-type="doughnut">Donut</button>
                                    <button class="btn btn-sm btn-outline" data-chart-type="bar">Bar</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="status-chart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h4>Yield Distribution (m/hr)</h4>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline active"
                                        data-chart-type="histogram">Histogram</button>
                                    <button class="btn btn-sm btn-outline" data-chart-type="boxplot">Box Plot</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="yield-chart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h4>Water Level Trends</h4>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline active" data-chart-type="line">Line</button>
                                    <button class="btn btn-sm btn-outline" data-chart-type="area">Area</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="water-level-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Data Table -->
                    <div class="data-table-container">
                        <div class="control-section-header mb-4">
                            <h4><i class="fas fa-table"></i> Borehole Data</h4>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline" id="export-table">
                                    <i class="fas fa-download"></i>
                                    Export CSV
                                </button>
                                <button class="btn btn-sm btn-outline" id="filter-table">
                                    <i class="fas fa-filter"></i>
                                    Filter
                                </button>
                            </div>
                        </div>

                        <table class="data-table" id="borehole-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Location</th>
                                    <th>Status</th>
                                    <th>Depth (m)</th>
                                    <th>Yield (m/hr)</th>
                                    <th>Water Level (m)</th>
                                    <th>Year</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="table-body">
                                <!-- Data will be populated dynamically -->
                            </tbody>
                        </table>

                        <div class="flex justify-between items-center mt-4">
                            <div class="text-sm text-muted" id="table-info">Showing 0 of 0 records</div>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline" id="prev-page" disabled>
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span class="px-3 py-1 text-sm" id="page-info">Page 1 of 1</span>
                                <button class="btn btn-sm btn-outline" id="next-page" disabled>
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analysis Tab Content -->
                <div id="analysis-tab" class="tab-content">
                    <div class="detailed-analysis-section">
                        <div class="analysis-section-header">
                            <div class="analysis-section-title">
                                <h3>Comprehensive Borehole Analysis</h3>
                                <p>Detailed statistical analysis of borehole performance, water levels, and yield
                                    patterns across Turkana County</p>
                            </div>
                        </div>

                        <div class="analysis-metrics">
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="analysis-yield-variance">0%</div>
                                <div class="analysis-metric-label">Yield Variance</div>
                                <div class="analysis-metric-description">Coefficient of variation in borehole yields
                                </div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="analysis-success-rate">0%</div>
                                <div class="analysis-metric-label">Drilling Success Rate</div>
                                <div class="analysis-metric-description">Percentage of successful boreholes</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="analysis-correlation">0.00</div>
                                <div class="analysis-metric-label">Depth-Yield Correlation</div>
                                <div class="analysis-metric-description">Relationship between depth and yield</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="analysis-seasonality">0%</div>
                                <div class="analysis-metric-label">Seasonal Variation</div>
                                <div class="analysis-metric-description">Water level seasonal fluctuation</div>
                            </div>
                        </div>

                        <div class="charts-grid">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Depth vs Yield Correlation</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="scatter">Scatter</button>
                                        <button class="btn btn-sm btn-outline"
                                            data-chart-type="regression">Regression</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="depth-yield-chart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Borehole Age Analysis</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="histogram">Histogram</button>
                                        <button class="btn btn-sm btn-outline" data-chart-type="line">Trend</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="age-analysis-chart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Spatial Distribution Analysis</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="heatmap">Heatmap</button>
                                        <button class="btn btn-sm btn-outline"
                                            data-chart-type="density">Density</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="spatial-analysis-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="analysis-matrix">
                            <div class="matrix-item">
                                <div class="matrix-value" id="matrix-yield-classification">0</div>
                                <div class="matrix-label">High Yield Boreholes (>20 m/hr)</div>
                            </div>
                            <div class="matrix-item">
                                <div class="matrix-value" id="matrix-deep-boreholes">0</div>
                                <div class="matrix-label">Deep Boreholes (>100m)</div>
                            </div>
                            <div class="matrix-item">
                                <div class="matrix-value" id="matrix-recent-boreholes">0</div>
                                <div class="matrix-label">Boreholes < 5 Years Old</div>
                                </div>
                                <div class="matrix-item">
                                    <div class="matrix-value" id="matrix-critical-areas">0</div>
                                    <div class="matrix-label">Critical Water Stress Areas</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Layers Tab Content -->
                    <div id="layers-tab" class="tab-content">
                        <div class="detailed-analysis-section">
                            <div class="analysis-section-header">
                                <div class="analysis-section-title">
                                    <h3>Data Layers & Integration</h3>
                                    <p>Multi-layer spatial analysis combining borehole data with geological,
                                        hydrological, and socio-economic layers</p>
                                </div>
                            </div>

                            <div class="analysis-cards">
                                <div class="analysis-card" data-layer="geological">
                                    <div class="analysis-card-header">
                                        <div class="analysis-card-icon"
                                            style="background: linear-gradient(135deg, #805ad5, #6b46c1);">
                                            <i class="fas fa-mountain"></i>
                                        </div>
                                        <div class="analysis-card-title">
                                            <h4>Geological Layers</h4>
                                            <p>Rock types, faults, aquifers</p>
                                        </div>
                                    </div>
                                    <div class="analysis-card-content">
                                        <p>Integrate geological maps with borehole data to understand aquifer
                                            characteristics and groundwater flow patterns.</p>
                                    </div>
                                    <div class="analysis-card-footer">
                                        <div class="analysis-card-tags">
                                            <span class="analysis-tag">Aquifer</span>
                                            <span class="analysis-tag">Faults</span>
                                            <span class="analysis-tag">Lithology</span>
                                        </div>
                                        <button class="btn btn-sm btn-outline">View Layer</button>
                                    </div>
                                </div>

                                <div class="analysis-card" data-layer="hydrological">
                                    <div class="analysis-card-header">
                                        <div class="analysis-card-icon"
                                            style="background: linear-gradient(135deg, #3182ce, #2b6cb0);">
                                            <i class="fas fa-water"></i>
                                        </div>
                                        <div class="analysis-card-title">
                                            <h4>Hydrological Layers</h4>
                                            <p>Rivers, watersheds, recharge</p>
                                        </div>
                                    </div>
                                    <div class="analysis-card-content">
                                        <p>Analyze surface water interactions and groundwater recharge patterns from
                                            hydrological features.</p>
                                    </div>
                                    <div class="analysis-card-footer">
                                        <div class="analysis-card-tags">
                                            <span class="analysis-tag">Rivers</span>
                                            <span class="analysis-tag">Watershed</span>
                                            <span class="analysis-tag">Recharge</span>
                                        </div>
                                        <button class="btn btn-sm btn-outline">View Layer</button>
                                    </div>
                                </div>

                                <div class="analysis-card" data-layer="socioeconomic">
                                    <div class="analysis-card-header">
                                        <div class="analysis-card-icon"
                                            style="background: linear-gradient(135deg, #38a169, #2f855a);">
                                            <i class="fas fa-users"></i>
                                        </div>
                                        <div class="analysis-card-title">
                                            <h4>Socio-economic Layers</h4>
                                            <p>Population, settlements, demand</p>
                                        </div>
                                    </div>
                                    <div class="analysis-card-content">
                                        <p>Combine population density and settlement patterns with water availability
                                            for demand-supply analysis.</p>
                                    </div>
                                    <div class="analysis-card-footer">
                                        <div class="analysis-card-tags">
                                            <span class="analysis-tag">Population</span>
                                            <span class="analysis-tag">Demand</span>
                                            <span class="analysis-tag">Settlements</span>
                                        </div>
                                        <button class="btn btn-sm btn-outline">View Layer</button>
                                    </div>
                                </div>

                                <div class="analysis-card" data-layer="climatic">
                                    <div class="analysis-card-header">
                                        <div class="analysis-card-icon"
                                            style="background: linear-gradient(135deg, #ed8936, #dd6b20);">
                                            <i class="fas fa-cloud-sun"></i>
                                        </div>
                                        <div class="analysis-card-title">
                                            <h4>Climatic Layers</h4>
                                            <p>Rainfall, temperature, evapotranspiration</p>
                                        </div>
                                    </div>
                                    <div class="analysis-card-content">
                                        <p>Integrate climate data to understand recharge patterns and groundwater
                                            sustainability under changing climate.</p>
                                    </div>
                                    <div class="analysis-card-footer">
                                        <div class="analysis-card-tags">
                                            <span class="analysis-tag">Rainfall</span>
                                            <span class="analysis-tag">Climate</span>
                                            <span class="analysis-tag">ET</span>
                                        </div>
                                        <button class="btn btn-sm btn-outline">View Layer</button>
                                    </div>
                                </div>
                            </div>

                            <div class="chart-card mt-6">
                                <div class="chart-header">
                                    <h4>Layer Integration Analysis</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="overlay">Overlay</button>
                                        <button class="btn btn-sm btn-outline"
                                            data-chart-type="correlation">Correlation</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="layer-integration-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reports Tab Content -->
                    <div id="reports-tab" class="tab-content">
                        <div class="detailed-analysis-section">
                            <div class="analysis-section-header">
                                <div class="analysis-section-title">
                                    <h3>Reports & Documentation</h3>
                                    <p>Generate comprehensive reports and export analysis results in multiple formats
                                    </p>
                                </div>
                            </div>

                            <div class="analysis-cards">
                                <div class="analysis-card">
                                    <div class="analysis-card-header">
                                        <div class="analysis-card-icon"
                                            style="background: linear-gradient(135deg, #3182ce, #2b6cb0);">
                                            <i class="fas fa-file-pdf"></i>
                                        </div>
                                        <div class="analysis-card-title">
                                            <h4>Comprehensive Report</h4>
                                            <p>Full analysis with charts and maps</p>
                                        </div>
                                    </div>
                                    <div class="analysis-card-content">
                                        <p>Generate a complete PDF report including all analysis results, charts, maps,
                                            and recommendations.</p>
                                    </div>
                                    <div class="analysis-card-footer">
                                        <div class="analysis-card-tags">
                                            <span class="analysis-tag primary">PDF</span>
                                            <span class="analysis-tag">50+ pages</span>
                                        </div>
                                        <button class="btn btn-sm btn-primary">Generate</button>
                                    </div>
                                </div>

                                <div class="analysis-card">
                                    <div class="analysis-card-header">
                                        <div class="analysis-card-icon"
                                            style="background: linear-gradient(135deg, #38a169, #2f855a);">
                                            <i class="fas fa-file-excel"></i>
                                        </div>
                                        <div class="analysis-card-title">
                                            <h4>Data Export</h4>
                                            <p>Raw and processed data</p>
                                        </div>
                                    </div>
                                    <div class="analysis-card-content">
                                        <p>Export all borehole data, analysis results, and statistics in Excel format
                                            for further processing.</p>
                                    </div>
                                    <div class="analysis-card-footer">
                                        <div class="analysis-card-tags">
                                            <span class="analysis-tag success">Excel</span>
                                            <span class="analysis-tag">CSV</span>
                                        </div>
                                        <button class="btn btn-sm btn-success">Export</button>
                                    </div>
                                </div>

                                <div class="analysis-card">
                                    <div class="analysis-card-header">
                                        <div class="analysis-card-icon"
                                            style="background: linear-gradient(135deg, #ed8936, #dd6b20);">
                                            <i class="fas fa-chart-bar"></i>
                                        </div>
                                        <div class="analysis-card-title">
                                            <h4>Executive Summary</h4>
                                            <p>Key findings and recommendations</p>
                                        </div>
                                    </div>
                                    <div class="analysis-card-content">
                                        <p>Create a concise summary report highlighting key findings, critical issues,
                                            and recommended actions.</p>
                                    </div>
                                    <div class="analysis-card-footer">
                                        <div class="analysis-card-tags">
                                            <span class="analysis-tag warning">Summary</span>
                                            <span class="analysis-tag">10 pages</span>
                                        </div>
                                        <button class="btn btn-sm btn-warning">Generate</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Predictive Tab Content -->
                    <div id="predictive-tab" class="tab-content">
                        <div class="detailed-analysis-section">
                            <div class="analysis-section-header">
                                <div class="analysis-section-title">
                                    <h3>Predictive Analysis & Modeling</h3>
                                    <p>Machine learning models for predicting borehole success, water levels, and future
                                        scenarios</p>
                                </div>
                            </div>

                            <div class="model-container">
                                <h4 class="mb-4">Borehole Success Prediction Model</h4>
                                <div class="model-parameters">
                                    <div class="model-parameter">
                                        <div class="model-parameter-label">Model Accuracy</div>
                                        <div class="model-parameter-value" id="model-accuracy">85.3%</div>
                                    </div>
                                    <div class="model-parameter">
                                        <div class="model-parameter-label">Predicted Success Rate</div>
                                        <div class="model-parameter-value" id="predicted-success">72.4%</div>
                                    </div>
                                    <div class="model-parameter">
                                        <div class="model-parameter-label">Key Predictors</div>
                                        <div class="model-parameter-value">Depth, Geology, Rainfall</div>
                                    </div>
                                </div>
                                <div class="chart-container mt-4" style="height: 200px;">
                                    <canvas id="prediction-model-chart"></canvas>
                                </div>
                            </div>

                            <div class="analysis-cards mt-6">
                                <div class="analysis-card">
                                    <div class="analysis-card-header">
                                        <div class="analysis-card-icon"
                                            style="background: linear-gradient(135deg, #805ad5, #6b46c1);">
                                            <i class="fas fa-brain"></i>
                                        </div>
                                        <div class="analysis-card-title">
                                            <h4>Water Level Prediction</h4>
                                            <p>Future water table scenarios</p>
                                        </div>
                                    </div>
                                    <div class="analysis-card-content">
                                        <p>Predict future water levels based on historical data, rainfall patterns, and
                                            extraction rates.</p>
                                    </div>
                                    <div class="analysis-card-footer">
                                        <div class="analysis-card-tags">
                                            <span class="analysis-tag">ML Model</span>
                                            <span class="analysis-tag">Forecast</span>
                                        </div>
                                        <button class="btn btn-sm btn-outline">Run Prediction</button>
                                    </div>
                                </div>

                                <div class="analysis-card">
                                    <div class="analysis-card-header">
                                        <div class="analysis-card-icon"
                                            style="background: linear-gradient(135deg, #3182ce, #2b6cb0);">
                                            <i class="fas fa-search-location"></i>
                                        </div>
                                        <div class="analysis-card-title">
                                            <h4>Optimal Site Selection</h4>
                                            <p>Identify best locations for new boreholes</p>
                                        </div>
                                    </div>
                                    <div class="analysis-card-content">
                                        <p>Use machine learning to identify optimal locations for new boreholes based on
                                            multiple factors.</p>
                                    </div>
                                    <div class="analysis-card-footer">
                                        <div class="analysis-card-tags">
                                            <span class="analysis-tag">Optimization</span>
                                            <span class="analysis-tag">GIS</span>
                                        </div>
                                        <button class="btn btn-sm btn-outline">Find Sites</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Borehole Analysis Page -->
                <div id="borehole-analysis-page" class="page-content">
                    <div class="detailed-analysis-section">
                        <div class="analysis-section-header">
                            <div class="analysis-section-title">
                                <h3>Advanced Borehole Performance Analysis</h3>
                                <p>In-depth statistical analysis of borehole characteristics, performance metrics, and
                                    operational efficiency</p>
                            </div>
                        </div>

                        <div class="analysis-metrics">
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="analysis-operational-efficiency">0%</div>
                                <div class="analysis-metric-label">Operational Efficiency</div>
                                <div class="analysis-metric-description">Based on yield vs design capacity</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="analysis-failure-rate">0%</div>
                                <div class="analysis-metric-label">Annual Failure Rate</div>
                                <div class="analysis-metric-description">Boreholes failing per year</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="analysis-repair-cost">KES 0</div>
                                <div class="analysis-metric-label">Avg Repair Cost</div>
                                <div class="analysis-metric-description">Average maintenance cost</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="analysis-lifespan">0 yrs</div>
                                <div class="analysis-metric-label">Average Lifespan</div>
                                <div class="analysis-metric-description">Functional borehole lifespan</div>
                            </div>
                        </div>

                        <div class="comparison-grid">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Yield Performance by Depth Category</h4>
                                </div>
                                <div class="chart-container">
                                    <canvas id="depth-category-chart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Age vs Performance Correlation</h4>
                                </div>
                                <div class="chart-container">
                                    <canvas id="age-performance-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="alert-system mt-6">
                            <h4 class="mb-4">Performance Alerts</h4>
                            <div class="alert critical">
                                <div class="alert-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="alert-content">
                                    <h5>Critical Yield Decline</h5>
                                    <p>15 boreholes showing >50% yield reduction in last 6 months</p>
                                </div>
                            </div>
                            <div class="alert warning">
                                <div class="alert-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="alert-content">
                                    <h5>Maintenance Due</h5>
                                    <p>24 boreholes overdue for scheduled maintenance</p>
                                </div>
                            </div>
                            <div class="alert info">
                                <div class="alert-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="alert-content">
                                    <h5>Performance Improvement</h5>
                                    <p>8 boreholes showing improved yield after rehabilitation</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Geospatial Analysis Page -->
                <div id="geospatial-analysis-page" class="page-content">
                    <div class="detailed-analysis-section">
                        <div class="analysis-section-header">
                            <div class="analysis-section-title">
                                <h3>Spatial Analysis & Hotspot Detection</h3>
                                <p>Geospatial analysis of borehole distribution, clustering patterns, and spatial
                                    correlations</p>
                            </div>
                        </div>

                        <div class="analysis-metrics">
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="spatial-density">0/km</div>
                                <div class="analysis-metric-label">Borehole Density</div>
                                <div class="analysis-metric-description">Boreholes per square kilometer</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="spatial-coverage">0%</div>
                                <div class="analysis-metric-label">Spatial Coverage</div>
                                <div class="analysis-metric-description">Area served by boreholes</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="spatial-autocorrelation">0.00</div>
                                <div class="analysis-metric-label">Spatial Autocorrelation</div>
                                <div class="analysis-metric-description">Moran's I statistic</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="accessibility-index">0%</div>
                                <div class="analysis-metric-label">Accessibility Index</div>
                                <div class="analysis-metric-description">Population within 1km of borehole</div>
                            </div>
                        </div>

                        <div class="charts-grid">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Spatial Distribution Heatmap</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="heatmap">Heatmap</button>
                                        <button class="btn btn-sm btn-outline"
                                            data-chart-type="cluster">Clusters</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="spatial-heatmap-chart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Accessibility Analysis</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="radius">Radius</button>
                                        <button class="btn btn-sm btn-outline"
                                            data-chart-type="voronoi">Voronoi</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="accessibility-chart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Spatial Correlation Matrix</h4>
                                </div>
                                <div class="chart-container">
                                    <canvas id="spatial-correlation-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="analysis-cards mt-6">
                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #f56565, #e53e3e);">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>High-Density Clusters</h4>
                                        <p>Areas with borehole clustering</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Identify areas with excessive borehole concentration causing resource
                                        competition.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag danger">5 Clusters</span>
                                        <span class="analysis-tag">Over-exploitation</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline">View Details</button>
                                </div>
                            </div>

                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #38a169, #2f855a);">
                                        <i class="fas fa-map-marker-alt"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>Service Gap Areas</h4>
                                        <p>Areas without borehole coverage</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Identify underserved areas requiring new borehole development.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag success">3 Priority Areas</span>
                                        <span class="analysis-tag">High Need</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline">View Details</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hydrogeological Analysis Page -->
                <div id="hydrogeological-analysis-page" class="page-content">
                    <div class="detailed-analysis-section">
                        <div class="analysis-section-header">
                            <div class="analysis-section-title">
                                <h3>Hydrogeological Analysis & Aquifer Characterization</h3>
                                <p>Analysis of aquifer properties, groundwater flow patterns, and hydrogeological
                                    parameters</p>
                            </div>
                        </div>

                        <div class="analysis-metrics">
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="aquifer-transmissivity">0 m/d</div>
                                <div class="analysis-metric-label">Avg Transmissivity</div>
                                <div class="analysis-metric-description">Aquifer transmission capacity</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="aquifer-storativity">0.000</div>
                                <div class="analysis-metric-label">Storativity Coefficient</div>
                                <div class="analysis-metric-description">Aquifer storage capacity</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="hydraulic-gradient">0.00</div>
                                <div class="analysis-metric-label">Hydraulic Gradient</div>
                                <div class="analysis-metric-description">Groundwater flow gradient</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="recharge-rate">0 mm/yr</div>
                                <div class="analysis-metric-label">Estimated Recharge Rate</div>
                                <div class="analysis-metric-description">Annual groundwater recharge</div>
                            </div>
                        </div>

                        <div class="water-quality-indicators">
                            <div class="quality-indicator good">
                                <div class="quality-indicator-icon">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div class="quality-indicator-content">
                                    <h5>Good Water Quality</h5>
                                    <p>65% of boreholes meet drinking water standards</p>
                                </div>
                            </div>
                            <div class="quality-indicator fair">
                                <div class="quality-indicator-icon">
                                    <i class="fas fa-exclamation"></i>
                                </div>
                                <div class="quality-indicator-content">
                                    <h5>Moderate Salinity</h5>
                                    <p>25% of boreholes show moderate salinity levels</p>
                                </div>
                            </div>
                            <div class="quality-indicator poor">
                                <div class="quality-indicator-icon">
                                    <i class="fas fa-times"></i>
                                </div>
                                <div class="quality-indicator-content">
                                    <h5>High Contamination Risk</h5>
                                    <p>10% of boreholes near contamination sources</p>
                                </div>
                            </div>
                        </div>

                        <div class="charts-grid mt-6">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Aquifer Property Distribution</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="distribution">Distribution</button>
                                        <button class="btn btn-sm btn-outline" data-chart-type="boxplot">Box
                                            Plot</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="aquifer-properties-chart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Groundwater Flow Direction</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="vector">Vector</button>
                                        <button class="btn btn-sm btn-outline"
                                            data-chart-type="contour">Contour</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="flow-direction-chart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Recharge-Discharge Balance</h4>
                                </div>
                                <div class="chart-container">
                                    <canvas id="water-balance-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="gap-results mt-6">
                            <h4 class="mb-4">Aquifer Stress Assessment</h4>
                            <div class="gap-category">
                                <div class="gap-category-header">
                                    <div class="gap-category-title">Over-exploited Aquifers</div>
                                    <div class="gap-category-severity high">High Stress</div>
                                </div>
                                <div class="gap-category-description">Aquifers where extraction exceeds recharge rates
                                </div>
                                <div class="gap-category-stats">
                                    <div class="gap-stat">
                                        <div class="gap-stat-value">3</div>
                                        <div class="gap-stat-label">Critical Aquifers</div>
                                    </div>
                                    <div class="gap-stat">
                                        <div class="gap-stat-value">-15%</div>
                                        <div class="gap-stat-label">Annual Balance</div>
                                    </div>
                                    <div class="gap-stat">
                                        <div class="gap-stat-value">42</div>
                                        <div class="gap-stat-label">Affected Boreholes</div>
                                    </div>
                                </div>
                            </div>

                            <div class="gap-category">
                                <div class="gap-category-header">
                                    <div class="gap-category-title">Moderately Stressed Aquifers</div>
                                    <div class="gap-category-severity medium">Medium Stress</div>
                                </div>
                                <div class="gap-category-description">Aquifers with balanced but declining water levels
                                </div>
                                <div class="gap-category-stats">
                                    <div class="gap-stat">
                                        <div class="gap-stat-value">7</div>
                                        <div class="gap-stat-label">Aquifers</div>
                                    </div>
                                    <div class="gap-stat">
                                        <div class="gap-stat-value">-2%</div>
                                        <div class="gap-stat-label">Annual Balance</div>
                                    </div>
                                    <div class="gap-stat">
                                        <div class="gap-stat-value">85</div>
                                        <div class="gap-stat-label">Affected Boreholes</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Water Quality Analysis Page -->
                <div id="water-quality-page" class="page-content">
                    <div class="detailed-analysis-section">
                        <div class="analysis-section-header">
                            <div class="analysis-section-title">
                                <h3>Water Quality Analysis & Contamination Risk Assessment</h3>
                                <p>Comprehensive analysis of water quality parameters, contamination sources, and health
                                    risks</p>
                            </div>
                        </div>

                        <div class="analysis-metrics">
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="quality-ph">7.2</div>
                                <div class="analysis-metric-label">Average pH</div>
                                <div class="analysis-metric-description">Water acidity/alkalinity</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="quality-tds">450 mg/L</div>
                                <div class="analysis-metric-label">Total Dissolved Solids</div>
                                <div class="analysis-metric-description">Water salinity level</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="quality-nitrate">12 mg/L</div>
                                <div class="analysis-metric-label">Nitrate Concentration</div>
                                <div class="analysis-metric-description">Agricultural contamination</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="quality-bacteria">8%</div>
                                <div class="analysis-metric-label">Bacterial Contamination</div>
                                <div class="analysis-metric-description">E. coli presence</div>
                            </div>
                        </div>

                        <div class="water-quality-indicators">
                            <div class="quality-indicator good">
                                <div class="quality-indicator-icon">
                                    <i class="fas fa-tint"></i>
                                </div>
                                <div class="quality-indicator-content">
                                    <h5>Excellent Quality</h5>
                                    <p>45% of boreholes meet all WHO standards</p>
                                </div>
                            </div>
                            <div class="quality-indicator fair">
                                <div class="quality-indicator-icon">
                                    <i class="fas fa-filter"></i>
                                </div>
                                <div class="quality-indicator-content">
                                    <h5>Requires Treatment</h5>
                                    <p>35% need basic treatment before consumption</p>
                                </div>
                            </div>
                            <div class="quality-indicator poor">
                                <div class="quality-indicator-icon">
                                    <i class="fas fa-skull-crossbones"></i>
                                </div>
                                <div class="quality-indicator-content">
                                    <h5>Unsafe for Drinking</h5>
                                    <p>20% exceed critical contamination limits</p>
                                </div>
                            </div>
                        </div>

                        <div class="charts-grid mt-6">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Water Quality Parameters Distribution</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="radar">Radar</button>
                                        <button class="btn btn-sm btn-outline"
                                            data-chart-type="parallel">Parallel</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="quality-parameters-chart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Contamination Source Analysis</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="pie">Sources</button>
                                        <button class="btn btn-sm btn-outline" data-chart-type="treemap">Impact</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="contamination-source-chart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Seasonal Quality Variation</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="line">Trend</button>
                                        <button class="btn btn-sm btn-outline" data-chart-type="area">Area</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="seasonal-quality-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="alert-system mt-6">
                            <h4 class="mb-4">Critical Water Quality Alerts</h4>
                            <div class="alert critical">
                                <div class="alert-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="alert-content">
                                    <h5>High Nitrate Levels</h5>
                                    <p>8 boreholes exceed 50mg/L nitrate (WHO limit: 50mg/L)</p>
                                </div>
                            </div>
                            <div class="alert warning">
                                <div class="alert-icon">
                                    <i class="fas fa-flask"></i>
                                </div>
                                <div class="alert-content">
                                    <h5>Elevated Fluoride</h5>
                                    <p>12 boreholes above 1.5mg/L fluoride concentration</p>
                                </div>
                            </div>
                            <div class="alert info">
                                <div class="alert-icon">
                                    <i class="fas fa-industry"></i>
                                </div>
                                <div class="alert-content">
                                    <h5>Industrial Contamination Risk</h5>
                                    <p>5 boreholes near industrial areas showing heavy metal traces</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Predictive Modeling Page -->
                <div id="predictive-modeling-page" class="page-content">
                    <div class="detailed-analysis-section">
                        <div class="analysis-section-header">
                            <div class="analysis-section-title">
                                <h3>Predictive Modeling & Future Scenarios</h3>
                                <p>Machine learning models for predicting borehole performance, water availability, and
                                    climate impacts</p>
                            </div>
                        </div>

                        <div class="analysis-metrics">
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="model-precision">89.2%</div>
                                <div class="analysis-metric-label">Model Precision</div>
                                <div class="analysis-metric-description">Prediction accuracy rate</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="future-yield">-8.5%</div>
                                <div class="analysis-metric-label">5-Year Yield Forecast</div>
                                <div class="analysis-metric-description">Predicted yield change</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="climate-impact">+12.3%</div>
                                <div class="analysis-metric-label">Climate Impact</div>
                                <div class="analysis-metric-description">Temperature effect on yield</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="recharge-prediction">-15%</div>
                                <div class="analysis-metric-label">Recharge Prediction</div>
                                <div class="analysis-metric-description">10-year recharge forecast</div>
                            </div>
                        </div>

                        <div class="model-container">
                            <h4 class="mb-4">Borehole Success Prediction Model</h4>
                            <div class="model-parameters">
                                <div class="model-parameter">
                                    <div class="model-parameter-label">Random Forest Accuracy</div>
                                    <div class="model-parameter-value">87.5%</div>
                                </div>
                                <div class="model-parameter">
                                    <div class="model-parameter-label">Neural Network Accuracy</div>
                                    <div class="model-parameter-value">89.2%</div>
                                </div>
                                <div class="model-parameter">
                                    <div class="model-parameter-label">Gradient Boosting Accuracy</div>
                                    <div class="model-parameter-value">90.1%</div>
                                </div>
                            </div>
                            <div class="chart-container mt-4" style="height: 250px;">
                                <canvas id="ml-models-chart"></canvas>
                            </div>
                        </div>

                        <div class="charts-grid mt-6">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Future Water Availability Scenarios</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="scenario">Scenarios</button>
                                        <button class="btn btn-sm btn-outline"
                                            data-chart-type="confidence">Confidence</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="future-scenarios-chart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Climate Change Impact Projection</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="projection">Projection</button>
                                        <button class="btn btn-sm btn-outline"
                                            data-chart-type="sensitivity">Sensitivity</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="climate-impact-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="analysis-cards mt-6">
                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #805ad5, #6b46c1);">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>AI-Powered Site Selection</h4>
                                        <p>Optimal borehole locations using AI</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Use artificial intelligence to identify optimal borehole locations with highest
                                        success probability.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag">AI Model</span>
                                        <span class="analysis-tag">95% Accuracy</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline">Run Analysis</button>
                                </div>
                            </div>

                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #3182ce, #2b6cb0);">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>Yield Prediction Model</h4>
                                        <p>Forecast borehole yield changes</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Predict future borehole yields based on historical data, climate patterns, and
                                        extraction rates.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag">Time Series</span>
                                        <span class="analysis-tag">LSTM Model</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline">Generate Forecast</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gap Analysis Page -->
                <div id="gap-analysis-page" class="page-content">
                    <div class="detailed-analysis-section">
                        <div class="analysis-section-header">
                            <div class="analysis-section-title">
                                <h3>Comprehensive Gap Analysis & Needs Assessment</h3>
                                <p>Identification of service gaps, infrastructure needs, and resource allocation
                                    requirements</p>
                            </div>
                        </div>

                        <div class="analysis-metrics">
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="gap-coverage">65%</div>
                                <div class="analysis-metric-label">Service Coverage</div>
                                <div class="analysis-metric-description">Population with water access</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="gap-unserved">125,000</div>
                                <div class="analysis-metric-label">Unserved Population</div>
                                <div class="analysis-metric-description">People without water access</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="gap-capacity">-35%</div>
                                <div class="analysis-metric-label">Capacity Deficit</div>
                                <div class="analysis-metric-description">Current vs required capacity</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="gap-investment">KES 850M</div>
                                <div class="analysis-metric-label">Investment Required</div>
                                <div class="analysis-metric-description">To close service gaps</div>
                            </div>
                        </div>

                        <div class="gap-results">
                            <div class="gap-category">
                                <div class="gap-category-header">
                                    <div class="gap-category-title">Infrastructure Gaps</div>
                                    <div class="gap-category-severity high">Critical</div>
                                </div>
                                <div class="gap-category-description">Insufficient borehole infrastructure to meet
                                    population needs</div>
                                <div class="gap-category-stats">
                                    <div class="gap-stat">
                                        <div class="gap-stat-value">48</div>
                                        <div class="gap-stat-label">New Boreholes Needed</div>
                                    </div>
                                    <div class="gap-stat">
                                        <div class="gap-stat-value">24</div>
                                        <div class="gap-stat-label">Rehabilitations Required</div>
                                    </div>
                                    <div class="gap-stat">
                                        <div class="gap-stat-value">KES 420M</div>
                                        <div class="gap-stat-label">Estimated Cost</div>
                                    </div>
                                </div>
                            </div>

                            <div class="gap-category">
                                <div class="gap-category-header">
                                    <div class="gap-category-title">Maintenance Gaps</div>
                                    <div class="gap-category-severity medium">Moderate</div>
                                </div>
                                <div class="gap-category-description">Inadequate maintenance leading to borehole
                                    failures</div>
                                <div class="gap-category-stats">
                                    <div class="gap-stat">
                                        <div class="gap-stat-value">65%</div>
                                        <div class="gap-stat-label">Below Standard Maintenance</div>
                                    </div>
                                    <div class="gap-stat">
                                        <div class="gap-stat-value">18</div>
                                        <div class="gap-stat-label">Critical Repairs Needed</div>
                                    </div>
                                    <div class="gap-stat">
                                        <div class="gap-stat-value">KES 120M</div>
                                        <div class="gap-stat-label">Maintenance Budget Gap</div>
                                    </div>
                                </div>
                            </div>

                            <div class="gap-category">
                                <div class="gap-category-header">
                                    <div class="gap-category-title">Quality Gaps</div>
                                    <div class="gap-category-severity low">Low</div>
                                </div>
                                <div class="gap-category-description">Water quality treatment and monitoring
                                    deficiencies</div>
                                <div class="gap-category-stats">
                                    <div class="gap-stat">
                                        <div class="gap-stat-value">32</div>
                                        <div class="gap-stat-label">Boreholes Need Treatment</div>
                                    </div>
                                    <div class="gap-stat">
                                        <div class="gap-stat-value">45%</div>
                                        <div class="gap-stat-label">Inadequate Monitoring</div>
                                    </div>
                                    <div class="gap-stat">
                                        <div class="gap-stat-value">KES 85M</div>
                                        <div class="gap-stat-label">Quality Improvement Cost</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="charts-grid mt-6">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Service Gap Analysis by Region</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active" data-chart-type="bar">Bar</button>
                                        <button class="btn btn-sm btn-outline" data-chart-type="radar">Radar</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="regional-gap-chart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Investment Priority Matrix</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="matrix">Matrix</button>
                                        <button class="btn btn-sm btn-outline" data-chart-type="bubble">Bubble</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="investment-priority-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="timeline mt-6">
                            <h4 class="mb-4">Implementation Timeline</h4>
                            <div class="timeline-item">
                                <div class="timeline-date">Year 1 (2024)</div>
                                <div class="timeline-content">
                                    <h5>Phase 1: Critical Infrastructure</h5>
                                    <p>Construct 15 new boreholes in highest priority areas, rehabilitate 8 critical
                                        boreholes</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">Year 2 (2025)</div>
                                <div class="timeline-content">
                                    <h5>Phase 2: Expansion & Quality</h5>
                                    <p>Add 20 new boreholes, implement water quality treatment at 15 locations</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">Year 3 (2026)</div>
                                <div class="timeline-content">
                                    <h5>Phase 3: Sustainability & Monitoring</h5>
                                    <p>Complete remaining boreholes, establish monitoring network, implement maintenance
                                        program</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sustainability Page -->
                <div id="sustainability-page" class="page-content">
                    <div class="detailed-analysis-section">
                        <div class="analysis-section-header">
                            <div class="analysis-section-title">
                                <h3>Sustainability Analysis & Resource Management</h3>
                                <p>Long-term sustainability assessment, environmental impact, and resource management
                                    strategies</p>
                            </div>
                        </div>

                        <div class="analysis-metrics">
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="sustainability-index">68%</div>
                                <div class="analysis-metric-label">Sustainability Index</div>
                                <div class="analysis-metric-description">Overall system sustainability</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="renewability-rate">85%</div>
                                <div class="analysis-metric-label">Resource Renewability</div>
                                <div class="analysis-metric-description">Extraction vs recharge balance</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="environmental-impact">Low</div>
                                <div class="analysis-metric-label">Environmental Impact</div>
                                <div class="analysis-metric-description">Ecosystem impact assessment</div>
                            </div>
                            <div class="analysis-metric">
                                <div class="analysis-metric-value" id="climate-resilience">Medium</div>
                                <div class="analysis-metric-label">Climate Resilience</div>
                                <div class="analysis-metric-description">Adaptation to climate change</div>
                            </div>
                        </div>

                        <div class="water-quality-indicators">
                            <div class="quality-indicator good">
                                <div class="quality-indicator-icon">
                                    <i class="fas fa-leaf"></i>
                                </div>
                                <div class="quality-indicator-content">
                                    <h5>Good Sustainability</h5>
                                    <p>45% of boreholes operating within sustainable limits</p>
                                </div>
                            </div>
                            <div class="quality-indicator fair">
                                <div class="quality-indicator-icon">
                                    <i class="fas fa-exclamation"></i>
                                </div>
                                <div class="quality-indicator-content">
                                    <h5>Moderate Concern</h5>
                                    <p>35% showing signs of unsustainable extraction</p>
                                </div>
                            </div>
                            <div class="quality-indicator poor">
                                <div class="quality-indicator-icon">
                                    <i class="fas fa-skull-crossbones"></i>
                                </div>
                                <div class="quality-indicator-content">
                                    <h5>Unsustainable</h5>
                                    <p>20% exceeding sustainable extraction rates</p>
                                </div>
                            </div>
                        </div>

                        <div class="charts-grid mt-6">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Sustainability Indicators Radar</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="radar">Radar</button>
                                        <button class="btn btn-sm btn-outline" data-chart-type="spider">Spider</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="sustainability-radar-chart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Long-term Resource Projection</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="projection">Projection</button>
                                        <button class="btn btn-sm btn-outline"
                                            data-chart-type="scenario">Scenarios</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="resource-projection-chart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4>Environmental Impact Assessment</h4>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline active"
                                            data-chart-type="impact">Impact</button>
                                        <button class="btn btn-sm btn-outline"
                                            data-chart-type="mitigation">Mitigation</button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="environmental-impact-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="analysis-cards mt-6">
                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #38a169, #2f855a);">
                                        <i class="fas fa-recycle"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>Water Conservation Strategies</h4>
                                        <p>Reduce consumption, increase efficiency</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Implement water-saving technologies, efficient irrigation, and consumption
                                        monitoring.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag success">25% Reduction</span>
                                        <span class="analysis-tag">Possible</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline">View Strategies</button>
                                </div>
                            </div>

                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #3182ce, #2b6cb0);">
                                        <i class="fas fa-cloud-rain"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>Artificial Recharge Methods</h4>
                                        <p>Enhance groundwater replenishment</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Implement rainwater harvesting, check dams, and recharge structures to enhance
                                        groundwater levels.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag">+15% Recharge</span>
                                        <span class="analysis-tag">Feasible</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline">View Methods</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Page -->
                <div id="reports-page" class="page-content">
                    <div class="detailed-analysis-section">
                        <div class="analysis-section-header">
                            <div class="analysis-section-title">
                                <h3>Reports Generation & Data Export</h3>
                                <p>Generate comprehensive reports, export data, and create customized analysis outputs
                                </p>
                            </div>
                        </div>

                        <div class="analysis-cards">
                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #3182ce, #2b6cb0);">
                                        <i class="fas fa-file-pdf"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>Comprehensive Technical Report</h4>
                                        <p>Full analysis with all data and charts</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Generate a complete PDF report including all analysis results, charts, maps, and
                                        technical details.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag primary">PDF</span>
                                        <span class="analysis-tag">80+ pages</span>
                                        <span class="analysis-tag">Technical</span>
                                    </div>
                                    <button class="btn btn-sm btn-primary">Generate Report</button>
                                </div>
                            </div>

                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #38a169, #2f855a);">
                                        <i class="fas fa-file-excel"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>Complete Data Export</h4>
                                        <p>All raw and processed data</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Export all borehole data, analysis results, statistics, and spatial data in
                                        Excel/CSV formats.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag success">Excel</span>
                                        <span class="analysis-tag">CSV</span>
                                        <span class="analysis-tag">GeoJSON</span>
                                    </div>
                                    <button class="btn btn-sm btn-success">Export Data</button>
                                </div>
                            </div>

                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #ed8936, #dd6b20);">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>Executive Dashboard</h4>
                                        <p>Interactive dashboard for decision makers</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Create an interactive HTML dashboard with key metrics, charts, and real-time data
                                        for executives.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag warning">HTML</span>
                                        <span class="analysis-tag">Interactive</span>
                                        <span class="analysis-tag">Real-time</span>
                                    </div>
                                    <button class="btn btn-sm btn-warning">Generate Dashboard</button>
                                </div>
                            </div>

                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #9f7aea, #805ad5);">
                                        <i class="fas fa-map-marked-alt"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>Spatial Analysis Maps</h4>
                                        <p>High-resolution maps and GIS data</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Export high-resolution maps, GIS layers, and spatial analysis results in multiple
                                        formats.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag">PNG</span>
                                        <span class="analysis-tag">Shapefile</span>
                                        <span class="analysis-tag">KML</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline">Export Maps</button>
                                </div>
                            </div>
                        </div>

                        <div class="chart-card mt-6">
                            <div class="chart-header">
                                <h4>Report Generation Statistics</h4>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline active" data-chart-type="bar">Usage</button>
                                    <button class="btn btn-sm btn-outline" data-chart-type="trend">Trend</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="report-statistics-chart"></canvas>
                            </div>
                        </div>

                        <div class="analysis-cards mt-6">
                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #f56565, #e53e3e);">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>Urgent Action Report</h4>
                                        <p>Critical issues requiring immediate attention</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Generate a focused report highlighting critical issues, emergency situations, and
                                        immediate action items.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag danger">Urgent</span>
                                        <span class="analysis-tag">Action Required</span>
                                        <span class="analysis-tag">10 pages</span>
                                    </div>
                                    <button class="btn btn-sm btn-danger">Generate Urgent Report</button>
                                </div>
                            </div>

                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #4a5568, #2d3748);">
                                        <i class="fas fa-database"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>Database Snapshot</h4>
                                        <p>Complete database backup and snapshot</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Create a complete database snapshot with all current data, configurations, and
                                        analysis results.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag">SQL</span>
                                        <span class="analysis-tag">Backup</span>
                                        <span class="analysis-tag">Archive</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline">Create Snapshot</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div id="settings-page" class="page-content">
                    <div class="detailed-analysis-section">
                        <div class="analysis-section-header">
                            <div class="analysis-section-title">
                                <h3>System Settings & Configuration</h3>
                                <p>Configure system parameters, user preferences, and analysis settings</p>
                            </div>
                        </div>

                        <div class="analysis-cards">
                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #3182ce, #2b6cb0);">
                                        <i class="fas fa-user-cog"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>User Preferences</h4>
                                        <p>Customize dashboard and analysis settings</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Configure display preferences, default views, chart styles, and personal
                                        settings.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag">Personalization</span>
                                        <span class="analysis-tag">Preferences</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline">Configure</button>
                                </div>
                            </div>

                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #38a169, #2f855a);">
                                        <i class="fas fa-database"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>Data Management</h4>
                                        <p>Manage data sources, imports, and exports</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Configure data sources, import/export settings, data validation rules, and update
                                        schedules.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag">Data Sources</span>
                                        <span class="analysis-tag">Import/Export</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline">Manage Data</button>
                                </div>
                            </div>

                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #ed8936, #dd6b20);">
                                        <i class="fas fa-chart-bar"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>Analysis Parameters</h4>
                                        <p>Configure analysis algorithms and thresholds</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Set analysis parameters, thresholds, algorithms, and calculation methods for all
                                        analysis modules.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag">Algorithms</span>
                                        <span class="analysis-tag">Thresholds</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline">Configure Analysis</button>
                                </div>
                            </div>

                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #f56565, #e53e3e);">
                                        <i class="fas fa-shield-alt"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>Security & Access Control</h4>
                                        <p>Manage users, permissions, and security</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Configure user accounts, access permissions, security settings, and
                                        authentication methods.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag">Security</span>
                                        <span class="analysis-tag">Permissions</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline">Security Settings</button>
                                </div>
                            </div>
                        </div>

                        <div class="chart-card mt-6">
                            <div class="chart-header">
                                <h4>System Performance Metrics</h4>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline active"
                                        data-chart-type="performance">Performance</button>
                                    <button class="btn btn-sm btn-outline" data-chart-type="usage">Usage</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="system-performance-chart"></canvas>
                            </div>
                        </div>

                        <div class="analysis-cards mt-6">
                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #9f7aea, #805ad5);">
                                        <i class="fas fa-bell"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>Notifications & Alerts</h4>
                                        <p>Configure alerts and notifications</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Set up alert thresholds, notification methods, and escalation rules for system
                                        events.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag">Alerts</span>
                                        <span class="analysis-tag">Notifications</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline">Configure Alerts</button>
                                </div>
                            </div>

                            <div class="analysis-card">
                                <div class="analysis-card-header">
                                    <div class="analysis-card-icon"
                                        style="background: linear-gradient(135deg, #4a5568, #2d3748);">
                                        <i class="fas fa-tools"></i>
                                    </div>
                                    <div class="analysis-card-title">
                                        <h4>System Maintenance</h4>
                                        <p>Backup, updates, and maintenance</p>
                                    </div>
                                </div>
                                <div class="analysis-card-content">
                                    <p>Configure backup schedules, system updates, maintenance windows, and recovery
                                        procedures.</p>
                                </div>
                                <div class="analysis-card-footer">
                                    <div class="analysis-card-tags">
                                        <span class="analysis-tag">Maintenance</span>
                                        <span class="analysis-tag">Backup</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline">Maintenance Settings</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- JavaScript Libraries -->
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
        <script src="https://unpkg.com/chart.js@4.4.0/dist/chart.umd.js"></script>
        <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
        <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
        <script src="https://unpkg.com/leaflet-fullscreen/dist/Leaflet.fullscreen.min.js"></script>
        <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
        <script src="https://unpkg.com/leaflet-measure@3.1.0/dist/leaflet-measure.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.1"></script>
        
        <script>
            // COMPREHENSIVE JAVASCRIPT APPLICATION WITH ALL ANALYSIS MODULES
            // This version includes 9 different analysis modules with complete functionality
            // FIXED: Added administrative boundary display and filter functionality
            // FIXED: GeoJSON parsing errors and browser privacy restrictions

            // Application State and Configuration
            const AppConfig = {
                // Map Configuration
                map: {
                    center: [2.5, 35.5],
                    zoom: 8,
                    minZoom: 6,
                    maxZoom: 18,
                    bounds: [[0.5, 34.0], [4.5, 36.5]],
                    maxBoundsViscosity: 1.0
                },

                // Data Configuration - using local data to avoid browser privacy restrictions
                dataUrls: {
                    boreholes: 'Turkana.json',
                    counties: 'data/counties.json',
                    subcounties: 'data/sub_counties.json'
                },

                // Colors Configuration
                colors: {
                    status: {
                        'functional': '#48bb78',
                        'non-functional': '#f56565',
                        'needs-repair': '#ed8936',
                        'abandoned': '#a0aec0',
                        'dry': '#4a5568',
                        'unknown': '#cbd5e0'
                    },
                    analysis: {
                        'borehole': '#3182ce',
                        'geospatial': '#38a169',
                        'hydrogeological': '#9f7aea',
                        'quality': '#ed8936',
                        'predictive': '#805ad5',
                        'gap': '#f56565',
                        'sustainability': '#48bb78',
                        'reports': '#4a5568'
                    },
                    boundaries: {
                        'county': '#3182ce',
                        'subcounty': '#38a169',
                        'highlight': '#f56565'
                    }
                },

                // Basemaps - using HTTPS URLs to avoid mixed content issues
                basemaps: {
                    osm: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: ' OpenStreetMap contributors',
                        maxZoom: 19
                    }),
                    satellite: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                        attribution: ' Esri, Maxar, Earthstar Geographics',
                        maxZoom: 19
                    }),
                    topo: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                        attribution: ' OpenTopoMap',
                        maxZoom: 17
                    }),
                    light: L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                        attribution: ' CARTO',
                        maxZoom: 19
                    }),
                    dark: L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                        attribution: ' CARTO',
                        maxZoom: 19
                    })
                },

                // Page Titles and Descriptions
                pages: {
                    'dashboard': {
                        title: 'Groundwater Resources Dashboard',
                        description: 'Comprehensive monitoring and analysis of groundwater resources in Turkana County'
                    },
                    'borehole-analysis': {
                        title: 'Borehole Performance Analysis',
                        description: 'Detailed statistical analysis of borehole characteristics and operational efficiency'
                    },
                    'geospatial-analysis': {
                        title: 'Geospatial Analysis & Hotspot Detection',
                        description: 'Spatial analysis of borehole distribution and service coverage patterns'
                    },
                    'hydrogeological-analysis': {
                        title: 'Hydrogeological Analysis & Aquifer Characterization',
                        description: 'Analysis of aquifer properties and groundwater flow dynamics'
                    },
                    'water-quality': {
                        title: 'Water Quality Analysis & Risk Assessment',
                        description: 'Comprehensive water quality monitoring and contamination risk analysis'
                    },
                    'predictive-modeling': {
                        title: 'Predictive Modeling & Future Scenarios',
                        description: 'Machine learning models for predicting borehole performance and water availability'
                    },
                    'gap-analysis': {
                        title: 'Gap Analysis & Needs Assessment',
                        description: 'Identification of service gaps and infrastructure development needs'
                    },
                    'sustainability': {
                        title: 'Sustainability Analysis & Resource Management',
                        description: 'Long-term sustainability assessment and environmental impact analysis'
                    },
                    'reports': {
                        title: 'Reports Generation & Data Export',
                        description: 'Generate comprehensive reports and export analysis results'
                    },
                    'settings': {
                        title: 'System Settings & Configuration',
                        description: 'Configure system parameters and user preferences'
                    }
                }
            };

            // Application State
            const AppState = {
                currentPage: 'dashboard',
                currentTab: 'map',
                isLoading: false,
                boreholes: [],
                filteredBoreholes: [],
                statistics: {},
                map: null,
                charts: {},
                layers: {},
                boundaries: {
                    county: null,
                    subcounty: null,
                    currentLayer: null
                },
                adminUnits: {
                    counties: [],
                    subcounties: []
                },
                currentAdminLevel: 'county',
                // Add this to track if we're using sample data
                usingSampleBoundaries: false
            };

            // Initialize Application
            document.addEventListener('DOMContentLoaded', () => {
                // Check if we're in a local file context
                if (window.location.protocol === 'file:') {
                    console.warn('Running in local file context - some features may be limited');
                    showNotification('Running in local mode - using sample data', 'warning');
                }

                // Add a small delay to ensure DOM is fully loaded
                setTimeout(() => {
                    initializeApplication();
                }, 100);
            });

            async function initializeApplication() {
                try {
                    showLoading('Initializing comprehensive analysis system...');

                    // Initialize map first
                    initializeMap();

                    // Initialize charts and event listeners
                    initializeCharts();
                    initializeEventListeners();

                    // Load data asynchronously
                    await loadData();

                    // Process data and update UI
                    processBoreholes();
                    updateStatistics();
                    updateUI();

                    // Try to load and display admin boundaries
                    await loadAndDisplayAdminBoundaries();

                    hideLoading();
                    showNotification('Analysis system loaded successfully!', 'success');

                } catch (error) {
                    console.error('Failed to initialize application:', error);
                    showError(`Failed to initialize: ${error.message}`);
                    hideLoading();
                }
            }

            // Load Data
            async function loadData() {
                showLoading('Loading borehole data...');

                try {
                    // Load sample data (replace with actual API call)
                    const sampleData = generateSampleData();
                    AppState.boreholes = sampleData;
                    AppState.filteredBoreholes = [...sampleData];

                    console.log(`Loaded ${AppState.boreholes.length} boreholes`);

                } catch (error) {
                    console.error('Error loading data:', error);
                    // Create fallback data
                    const fallbackData = generateFallbackData();
                    AppState.boreholes = fallbackData;
                    AppState.filteredBoreholes = [...fallbackData];
                    showNotification('Using sample borehole data', 'warning');
                }
            }

            // Load and Display Admin Boundaries
            async function loadAndDisplayAdminBoundaries() {
                try {
                    // Load administrative boundaries
                    await loadAdminBoundaries();

                    // Display the initial boundaries
                    displayAdminBoundaries(AppState.currentAdminLevel);

                } catch (error) {
                    console.error('Error loading admin boundaries:', error);
                    // Generate sample admin data for demonstration
                    AppState.adminUnits.counties = generateSampleAdminData('county');
                    AppState.adminUnits.subcounties = generateSampleAdminData('subcounty');
                    AppState.usingSampleBoundaries = true;
                    updateAdminUnitDropdown();

                    // Display sample boundaries
                    displayAdminBoundaries(AppState.currentAdminLevel);

                    showNotification('Using sample administrative boundaries', 'warning');
                }
            }

            // Load Administrative Boundaries with better error handling
            async function loadAdminBoundaries() {
                console.log('Loading administrative boundaries...');

                // Try to load county boundaries
                try {
                    if (AppConfig.dataUrls.counties) {
                        const response = await fetch(AppConfig.dataUrls.counties);
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const text = await response.text();
                        console.log('Raw counties data (first 500 chars):', text.substring(0, 500));

                        let countyData;
                        try {
                            countyData = JSON.parse(text);
                        } catch (parseError) {
                            console.error('Failed to parse counties JSON:', parseError);
                            // Try to fix common JSON issues
                            const fixedText = text.replace(/,\s*}/g, '}').replace(/,\s*]/g, ']');
                            countyData = JSON.parse(fixedText);
                        }

                        AppState.adminUnits.counties = processAdminData(countyData, 'county');
                        console.log(`Processed ${AppState.adminUnits.counties.length} county units`);
                    }
                } catch (error) {
                    console.error('Error loading county boundaries:', error);
                    throw error; // Re-throw to be caught by caller
                }

                // Try to load subcounty boundaries
                try {
                    if (AppConfig.dataUrls.subcounties) {
                        const response = await fetch(AppConfig.dataUrls.subcounties);
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const text = await response.text();
                        console.log('Raw subcounties data (first 500 chars):', text.substring(0, 500));

                        let subcountyData;
                        try {
                            subcountyData = JSON.parse(text);
                        } catch (parseError) {
                            console.error('Failed to parse subcounties JSON:', parseError);
                            // Try to fix common JSON issues
                            const fixedText = text.replace(/,\s*}/g, '}').replace(/,\s*]/g, ']');
                            subcountyData = JSON.parse(fixedText);
                        }

                        AppState.adminUnits.subcounties = processAdminData(subcountyData, 'subcounty');
                        console.log(`Processed ${AppState.adminUnits.subcounties.length} subcounty units`);
                    }
                } catch (error) {
                    console.error('Error loading subcounty boundaries:', error);
                    // Don't re-throw here - we might still have county data
                }

                // Update admin unit dropdown
                updateAdminUnitDropdown();

                return true;
            }

            // Process Admin Data with better validation
            function processAdminData(data, level) {
                console.log(`Processing ${level} data:`, data);

                if (!data) {
                    console.warn(`No data provided for ${level}`);
                    return [];
                }

                if (!data.features || !Array.isArray(data.features)) {
                    console.warn(`Invalid GeoJSON format for ${level}: missing features array`);

                    // Try to handle as a single feature
                    if (data.type === 'Feature') {
                        data = { type: 'FeatureCollection', features: [data] };
                    } else if (data.type === 'FeatureCollection' && data.features === undefined) {
                        // Try to find features in other properties
                        for (const key in data) {
                            if (Array.isArray(data[key]) && data[key].length > 0 && data[key][0].properties) {
                                data.features = data[key];
                                break;
                            }
                        }
                    }

                    if (!data.features) {
                        console.error(`Could not extract features for ${level}`);
                        return [];
                    }
                }

                const processedFeatures = [];

                data.features.forEach((feature, index) => {
                    try {
                        const props = feature.properties || {};
                        const processedFeature = {
                            id: props.FID || props.id || index,
                            name: getAdminName(props, level),
                            code: getAdminCode(props, level),
                            level: level,
                            feature: feature,
                            bounds: getFeatureBounds(feature)
                        };

                        processedFeatures.push(processedFeature);
                    } catch (error) {
                        console.warn(`Error processing feature ${index} for ${level}:`, error);
                    }
                });

                console.log(`Successfully processed ${processedFeatures.length} ${level} features`);
                return processedFeatures;
            }

            // Helper functions for admin data processing
            function getAdminName(props, level) {
                if (level === 'county') {
                    return props.ADM1_EN || props.ADM1_EN || props.NAME || props.name || `County ${props.FID || ''}`;
                } else {
                    return props.ADM2_EN || props.ADM2_EN || props.NAME || props.name || `Subcounty ${props.FID || ''}`;
                }
            }

            function getAdminCode(props, level) {
                if (level === 'county') {
                    return props.ADM1_PCODE || props.ADM1_PCODE || props.CODE || props.code || '';
                } else {
                    return props.ADM2_PCODE || props.ADM2_PCODE || props.CODE || props.code || '';
                }
            }

            function getFeatureBounds(feature) {
                if (!feature || !feature.geometry) {
                    console.warn('Feature has no geometry:', feature);
                    return null;
                }

                const geometry = feature.geometry;
                let coordinates = geometry.coordinates;

                if (!coordinates) {
                    console.warn('Feature geometry has no coordinates:', geometry);
                    return null;
                }

                let minLat = Infinity, maxLat = -Infinity;
                let minLng = Infinity, maxLng = -Infinity;

                const processCoordinate = (coord) => {
                    if (!Array.isArray(coord) || coord.length < 2) return;

                    let lng, lat;
                    // Handle both [lng, lat] and [lat, lng] formats
                    if (Math.abs(coord[0]) <= 180 && Math.abs(coord[1]) <= 90) {
                        // Likely [lng, lat]
                        lng = coord[0];
                        lat = coord[1];
                    } else {
                        // Try [lat, lng]
                        lng = coord[1];
                        lat = coord[0];
                    }

                    minLat = Math.min(minLat, lat);
                    maxLat = Math.max(maxLat, lat);
                    minLng = Math.min(minLng, lng);
                    maxLng = Math.max(maxLng, lng);
                };

                const processCoordinatesArray = (coords) => {
                    if (!Array.isArray(coords)) return;

                    if (Array.isArray(coords[0]) && Array.isArray(coords[0][0])) {
                        // Multi-dimensional array (Polygon or MultiPolygon rings)
                        coords.forEach(ring => {
                            if (Array.isArray(ring)) {
                                ring.forEach(coord => processCoordinate(coord));
                            }
                        });
                    } else if (Array.isArray(coords[0])) {
                        // Array of coordinates
                        coords.forEach(coord => processCoordinate(coord));
                    } else {
                        // Single coordinate
                        processCoordinate(coords);
                    }
                };

                try {
                    if (geometry.type === 'MultiPolygon') {
                        coordinates.forEach(polygon => {
                            if (Array.isArray(polygon)) {
                                polygon.forEach(ring => processCoordinatesArray(ring));
                            }
                        });
                    } else if (geometry.type === 'Polygon') {
                        coordinates.forEach(ring => processCoordinatesArray(ring));
                    } else if (geometry.type === 'LineString') {
                        processCoordinatesArray(coordinates);
                    } else if (geometry.type === 'Point') {
                        processCoordinate(coordinates);
                    } else {
                        console.warn(`Unsupported geometry type: ${geometry.type}`);
                        // Try to process anyway
                        processCoordinatesArray(coordinates);
                    }
                } catch (error) {
                    console.error('Error processing geometry coordinates:', error, coordinates);
                    return null;
                }

                if (minLat === Infinity || maxLat === -Infinity || minLng === Infinity || maxLng === -Infinity) {
                    return null;
                }

                return [[minLat, minLng], [maxLat, maxLng]];
            }

            // Generate Sample Admin Data
            function generateSampleAdminData(level) {
                const names = level === 'county'
                    ? ['Turkana Central', 'Turkana West', 'Turkana East', 'Turkana North', 'Turkana South', 'Loima', 'Kibish']
                    : ['Lodwar', 'Kakuma', 'Lokichogio', 'Lokichar', 'Kalokol', 'Loreng', 'Kainuk', 'Kapedo'];

                const baseLat = 2.5;
                const baseLng = 35.5;

                return names.map((name, index) => {
                    const latOffset = (index % 3) * 0.5;
                    const lngOffset = Math.floor(index / 3) * 0.5;

                    return {
                        id: index + 1,
                        name: name,
                        code: `${level === 'county' ? 'TC' : 'LD'}${(index + 1).toString().padStart(2, '0')}`,
                        level: level,
                        bounds: [
                            [baseLat + latOffset - 0.25, baseLng + lngOffset - 0.25],
                            [baseLat + latOffset + 0.25, baseLng + lngOffset + 0.25]
                        ],
                        // Create a simple GeoJSON feature for display
                        feature: {
                            type: 'Feature',
                            properties: {
                                name: name,
                                code: `${level === 'county' ? 'TC' : 'LD'}${(index + 1).toString().padStart(2, '0')}`,
                                level: level
                            },
                            geometry: {
                                type: 'Polygon',
                                coordinates: [[
                                    [baseLng + lngOffset - 0.25, baseLat + latOffset - 0.25],
                                    [baseLng + lngOffset + 0.25, baseLat + latOffset - 0.25],
                                    [baseLng + lngOffset + 0.25, baseLat + latOffset + 0.25],
                                    [baseLng + lngOffset - 0.25, baseLat + latOffset + 0.25],
                                    [baseLng + lngOffset - 0.25, baseLat + latOffset - 0.25]
                                ]]
                            }
                        }
                    };
                });
            }

            // Update Admin Unit Dropdown
            function updateAdminUnitDropdown() {
                const dropdown = document.getElementById('admin-unit-filter');
                if (!dropdown) {
                    console.warn('Admin unit dropdown not found');
                    return;
                }

                // Clear existing options
                dropdown.innerHTML = '<option value="all">All Turkana County</option>';

                // Get current admin units based on selected level
                const adminUnits = AppState.currentAdminLevel === 'county'
                    ? AppState.adminUnits.counties
                    : AppState.adminUnits.subcounties;

                if (!adminUnits || adminUnits.length === 0) {
                    console.warn(`No ${AppState.currentAdminLevel} units available`);
                    return;
                }

                // Add options for each admin unit
                adminUnits.forEach(unit => {
                    const option = document.createElement('option');
                    option.value = unit.code || unit.id;
                    option.textContent = unit.name;
                    dropdown.appendChild(option);
                });

                console.log(`Updated dropdown with ${adminUnits.length} ${AppState.currentAdminLevel} units`);
            }

            // Generate Sample Data
            function generateSampleData() {
                const boreholes = [];
                const localities = ['Lodwar', 'Kakuma', 'Lokichogio', 'Lokichar', 'Kalokol', 'Loreng', 'Kainuk', 'Kapedo'];
                const statuses = ['functional', 'non-functional', 'needs-repair', 'abandoned', 'dry'];

                // Turkana County bounds
                const minLat = 0.5;
                const maxLat = 4.5;
                const minLng = 34.0;
                const maxLng = 36.5;

                for (let i = 1; i <= 100; i++) {
                    const lat = minLat + Math.random() * (maxLat - minLat);
                    const lng = minLng + Math.random() * (maxLng - minLng);
                    const status = statuses[Math.floor(Math.random() * statuses.length)];
                    const yieldValue = status === 'functional' ? (Math.random() * 40 + 5) :
                        status === 'needs-repair' ? (Math.random() * 10) : 0;
                    const depth = Math.random() * 150 + 20;
                    const waterLevel = Math.random() * 50 + 5;
                    const year = 2000 + Math.floor(Math.random() * 23);
                    const locality = localities[Math.floor(Math.random() * localities.length)];

                    // Add water quality parameters
                    const ph = 6.5 + Math.random() * 2.5;
                    const tds = 200 + Math.random() * 800;
                    const nitrate = Math.random() * 40;
                    const bacteria = Math.random() > 0.8;

                    boreholes.push({
                        id: i,
                        name: `Borehole ${i}`,
                        coordinates: [lat, lng],
                        properties: {
                            name: `Borehole ${i}`,
                            operation_: status,
                            yield: yieldValue,
                            well_depth: depth,
                            water_rest: waterLevel,
                            drilling_e: `${year}-${Math.floor(Math.random() * 12) + 1}-${Math.floor(Math.random() * 28) + 1}`,
                            locality: locality,
                            admin_4: locality,
                            // Water quality parameters
                            ph: ph,
                            tds: tds,
                            nitrate: nitrate,
                            bacteria: bacteria ? 'Positive' : 'Negative'
                        }
                    });
                }

                return boreholes;
            }

            // Generate Fallback Data
            function generateFallbackData() {
                return generateSampleData();
            }

            // Initialize Map
            function initializeMap() {
                AppState.map = L.map('main-map', {
                    center: AppConfig.map.center,
                    zoom: AppConfig.map.zoom,
                    minZoom: AppConfig.map.minZoom,
                    maxZoom: AppConfig.map.maxZoom,
                    maxBounds: AppConfig.map.bounds,
                    maxBoundsViscosity: AppConfig.map.maxBoundsViscosity,
                    zoomControl: false,
                    attributionControl: false
                });

                // Add default basemap
                AppConfig.basemaps.osm.addTo(AppState.map);

                // Add controls
                L.control.scale({ imperial: false }).addTo(AppState.map);

                // Add geocoder
                const geocoder = L.Control.geocoder({
                    defaultMarkGeocode: false,
                    position: 'topleft',
                    placeholder: 'Search location...',
                    collapsed: true
                });
                geocoder.on('markgeocode', (e) => {
                    AppState.map.fitBounds(e.geocode.bbox);
                });
                AppState.map.addControl(geocoder);

                // Add fullscreen control
                if (L.control.fullscreen) {
                    AppState.map.addControl(L.control.fullscreen());
                }

                // Initialize layers
                AppState.layers = {
                    boreholes: L.layerGroup(),
                    cluster: L.markerClusterGroup(),
                    boundaries: L.layerGroup(),
                    highlightedBoundary: L.layerGroup()
                };

                AppState.map.addLayer(AppState.layers.cluster);
                AppState.map.addLayer(AppState.layers.boundaries);
                AppState.map.addLayer(AppState.layers.highlightedBoundary);

                // Initialize legend content
                updateLegend();
            }

            // Display Administrative Boundaries
            function displayAdminBoundaries(level) {
                console.log(`Displaying ${level} boundaries...`);

                // Clear existing boundaries
                AppState.layers.boundaries.clearLayers();

                if (AppState.boundaries.currentLayer) {
                    AppState.map.removeLayer(AppState.boundaries.currentLayer);
                    AppState.boundaries.currentLayer = null;
                }

                // Get the appropriate data for the selected level
                const adminData = level === 'county'
                    ? AppState.adminUnits.counties
                    : AppState.adminUnits.subcounties;

                if (!adminData || adminData.length === 0) {
                    console.warn(`No ${level} data available`);
                    showNotification(`No ${level} boundaries available`, 'warning');
                    return;
                }

                // Collect all valid features
                const validFeatures = [];

                adminData.forEach((unit, index) => {
                    if (unit.feature) {
                        try {
                            // Validate the feature before adding
                            if (unit.feature.type && unit.feature.geometry) {
                                validFeatures.push(unit.feature);
                            } else {
                                console.warn(`Invalid feature for ${unit.name}`, unit.feature);
                            }
                        } catch (error) {
                            console.warn(`Error processing feature for ${unit.name}:`, error);
                        }
                    }
                });

                if (validFeatures.length === 0) {
                    console.warn(`No valid features found for ${level}`);
                    showNotification(`Could not display ${level} boundaries`, 'warning');
                    return;
                }

                const featureCollection = {
                    type: 'FeatureCollection',
                    features: validFeatures
                };

                console.log(`Creating GeoJSON layer with ${validFeatures.length} features`);

                try {
                    // Create the GeoJSON layer with styling 
                    AppState.boundaries.currentLayer = L.geoJSON(featureCollection, {
                        style: function (feature) {
                            return {
                                color: level === 'county'
                                    ? AppConfig.colors.boundaries.county
                                    : AppConfig.colors.boundaries.subcounty,
                                weight: level === 'county' ? 3 : 2,
                                opacity: 0.8,
                                fillColor: level === 'county'
                                    ? AppConfig.colors.boundaries.county
                                    : AppConfig.colors.boundaries.subcounty,
                                fillOpacity: 0.1,
                                dashArray: level === 'county' ? null : '5, 5'
                            };
                        },
                        onEachFeature: function (feature, layer) {
                            // Add popup with admin unit info
                            if (feature.properties && feature.properties.name) {
                                layer.bindPopup(`
                                    <div style="min-width: 200px;">
                                        <strong>${feature.properties.name}</strong><br>
                                        ${feature.properties.code ? `Code: ${feature.properties.code}<br>` : ''}
                                        Level: ${feature.properties.level || level}
                                    </div>
                                `);
                            }

                            // Add click handler to zoom to boundary
                            layer.on('click', function (e) {
                                try {
                                    const bounds = layer.getBounds();
                                    if (bounds.isValid()) {
                                        AppState.map.fitBounds(bounds);
                                        showNotification(`Zoomed to ${feature.properties.name || 'area'}`, 'info');
                                    }
                                } catch (error) {
                                    console.warn('Error getting bounds:', error);
                                }
                            });
                        }
                    });

                    // Add to map and layer group
                    AppState.boundaries.currentLayer.addTo(AppState.map);
                    AppState.boundaries.currentLayer.addTo(AppState.layers.boundaries);

                    console.log(`Successfully displayed ${validFeatures.length} ${level} boundaries`);
                    showNotification(`${level === 'county' ? 'County' : 'Sub-county'} boundaries displayed`, 'success');

                } catch (error) {
                    console.error('Error creating GeoJSON layer:', error);
                    showNotification(`Error displaying ${level} boundaries`, 'error');

                    // Try a simpler approach
                    try {
                        adminData.forEach(unit => {
                            if (unit.bounds) {
                                const rect = L.rectangle(unit.bounds, {
                                    color: level === 'county'
                                        ? AppConfig.colors.boundaries.county
                                        : AppConfig.colors.boundaries.subcounty,
                                    weight: 2,
                                    opacity: 0.8,
                                    fillOpacity: 0.1
                                });

                                rect.bindPopup(`<strong>${unit.name}</strong>`);
                                rect.addTo(AppState.layers.boundaries);
                            }
                        });
                        console.log('Displayed boundaries using simple rectangles');
                    } catch (simpleError) {
                        console.error('Even simple display failed:', simpleError);
                    }
                }

                // Update legend
                updateLegend();
            }

            // Update Legend
            function updateLegend() {
                const legendContent = document.getElementById('legend-content');
                if (!legendContent) return;

                let html = '';

                // Add borehole status legend
                html += '<div class="legend-item"><strong>Borehole Status</strong></div>';
                for (const [status, color] of Object.entries(AppConfig.colors.status)) {
                    const label = status.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
                    html += `
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: ${color};"></div>
                            <span>${label}</span>
                        </div>
                    `;
                }

                // Add boundary legend
                html += '<div class="legend-item" style="margin-top: 10px;"><strong>Boundaries</strong></div>';
                html += `
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: ${AppConfig.colors.boundaries.county}; border: 2px solid ${AppConfig.colors.boundaries.county};"></div>
                        <span>County Boundaries</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: ${AppConfig.colors.boundaries.subcounty}; border: 2px solid ${AppConfig.colors.boundaries.subcounty};"></div>
                        <span>Sub-county Boundaries</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: ${AppConfig.colors.boundaries.highlight}; border: 2px solid ${AppConfig.colors.boundaries.highlight};"></div>
                        <span>Selected Area</span>
                    </div>
                `;

                legendContent.innerHTML = html;
            }

            // Highlight Specific Admin Unit
            function highlightAdminUnit(unitCode) {
                AppState.layers.highlightedBoundary.clearLayers();

                if (unitCode === 'all') {
                    // If "all" is selected, remove any highlighting
                    showNotification('Showing all boreholes', 'info');
                    return;
                }

                // Find the admin unit
                const adminUnits = AppState.currentAdminLevel === 'county'
                    ? AppState.adminUnits.counties
                    : AppState.adminUnits.subcounties;

                const unit = adminUnits.find(u => u.code === unitCode || u.id.toString() === unitCode);

                if (!unit) {
                    console.warn(`Admin unit with code ${unitCode} not found`);
                    showNotification('Selected area not found', 'warning');
                    return;
                }

                // Create highlighted boundary
                let feature;
                if (unit.feature) {
                    feature = unit.feature;
                } else if (unit.bounds) {
                    // Create a simple polygon for demonstration
                    feature = {
                        type: 'Feature',
                        properties: {
                            name: unit.name,
                            code: unit.code,
                            level: AppState.currentAdminLevel
                        },
                        geometry: {
                            type: 'Polygon',
                            coordinates: [[
                                [unit.bounds[0][1], unit.bounds[0][0]],
                                [unit.bounds[1][1], unit.bounds[0][0]],
                                [unit.bounds[1][1], unit.bounds[1][0]],
                                [unit.bounds[0][1], unit.bounds[1][0]],
                                [unit.bounds[0][1], unit.bounds[0][0]]
                            ]]
                        }
                    };
                } else {
                    console.warn(`No geometry data for ${unit.name}`);
                    showNotification(`No boundary data for ${unit.name}`, 'warning');
                    return;
                }

                // Add highlighted layer
                try {
                    const highlightLayer = L.geoJSON(feature, {
                        style: {
                            color: AppConfig.colors.boundaries.highlight,
                            weight: 4,
                            opacity: 1,
                            fillColor: AppConfig.colors.boundaries.highlight,
                            fillOpacity: 0.2,
                            dashArray: null
                        },
                        onEachFeature: function (feature, layer) {
                            layer.bindPopup(`
                                <div style="min-width: 200px;">
                                    <strong>Selected: ${feature.properties.name}</strong><br>
                                    ${feature.properties.code ? `Code: ${feature.properties.code}<br>` : ''}
                                    Click to zoom
                                </div>
                            `);

                            layer.on('click', function (e) {
                                if (unit.bounds) {
                                    AppState.map.fitBounds(unit.bounds, { padding: [50, 50] });
                                } else if (layer.getBounds) {
                                    try {
                                        const bounds = layer.getBounds();
                                        if (bounds.isValid()) {
                                            AppState.map.fitBounds(bounds, { padding: [50, 50] });
                                        }
                                    } catch (error) {
                                        console.warn('Error getting bounds:', error);
                                    }
                                }
                            });
                        }
                    });

                    highlightLayer.addTo(AppState.layers.highlightedBoundary);

                    // Zoom to the highlighted unit if it has bounds
                    if (unit.bounds) {
                        AppState.map.fitBounds(unit.bounds, { padding: [50, 50] });
                    } else if (highlightLayer.getBounds) {
                        try {
                            const bounds = highlightLayer.getBounds();
                            if (bounds.isValid()) {
                                AppState.map.fitBounds(bounds, { padding: [50, 50] });
                            }
                        } catch (error) {
                            console.warn('Error getting bounds from layer:', error);
                        }
                    }

                    showNotification(`Highlighting ${unit.name}`, 'info');

                } catch (error) {
                    console.error('Error creating highlight layer:', error);
                    showNotification(`Error highlighting ${unit.name}`, 'error');
                }
            }

            // Initialize Charts
            function initializeCharts() {
                // Dashboard Charts
                AppState.charts.status = createChart('status-chart', {
                    type: 'pie',
                    data: {
                        labels: ['Functional', 'Non-Functional', 'Needs Repair', 'Abandoned', 'Dry'],
                        datasets: [{
                            data: [0, 0, 0, 0, 0],
                            backgroundColor: [
                                AppConfig.colors.status.functional,
                                AppConfig.colors.status['non-functional'],
                                AppConfig.colors.status['needs-repair'],
                                AppConfig.colors.status.abandoned,
                                AppConfig.colors.status.dry
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });

                AppState.charts.yield = createChart('yield-chart', {
                    type: 'bar',
                    data: {
                        labels: ['0-5', '5-10', '10-20', '20-30', '30-50', '50+'],
                        datasets: [{
                            label: 'Number of Boreholes',
                            data: [0, 0, 0, 0, 0, 0],
                            backgroundColor: AppConfig.colors.analysis.borehole
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });

                // Analysis Charts
                AppState.charts.depthYield = createChart('depth-yield-chart', {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Depth vs Yield',
                            data: [],
                            backgroundColor: AppConfig.colors.analysis.borehole
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: { title: { display: true, text: 'Depth (m)' } },
                            y: { title: { display: true, text: 'Yield (m/hr)' } }
                        }
                    }
                });

                // Initialize all other charts
                initializeAdditionalCharts();
            }

            // Initialize Additional Charts
            function initializeAdditionalCharts() {
                const chartConfigs = {
                    // Water Quality Charts
                    'quality-parameters-chart': {
                        type: 'radar',
                        data: {
                            labels: ['pH', 'TDS', 'Nitrate', 'Fluoride', 'Bacteria', 'Turbidity'],
                            datasets: [{
                                label: 'Average Values',
                                data: [7.2, 450, 12, 0.8, 8, 15],
                                backgroundColor: 'rgba(237, 137, 54, 0.2)',
                                borderColor: AppConfig.colors.analysis.quality,
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    max: 100
                                }
                            }
                        }
                    },

                    // Sustainability Charts
                    'sustainability-radar-chart': {
                        type: 'radar',
                        data: {
                            labels: ['Extraction Rate', 'Recharge Rate', 'Water Quality', 'Infrastructure', 'Community', 'Economic'],
                            datasets: [{
                                label: 'Sustainability Index',
                                data: [85, 72, 68, 75, 80, 65],
                                backgroundColor: 'rgba(72, 187, 120, 0.2)',
                                borderColor: AppConfig.colors.analysis.sustainability,
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    max: 100
                                }
                            }
                        }
                    },

                    // Predictive Modeling Charts
                    'future-scenarios-chart': {
                        type: 'line',
                        data: {
                            labels: ['2024', '2025', '2026', '2027', '2028', '2029', '2030'],
                            datasets: [
                                {
                                    label: 'Optimistic Scenario',
                                    data: [100, 105, 110, 115, 120, 125, 130],
                                    borderColor: AppConfig.colors.status.functional,
                                    fill: false
                                },
                                {
                                    label: 'Business as Usual',
                                    data: [100, 98, 95, 92, 88, 85, 82],
                                    borderColor: AppConfig.colors.status.warning,
                                    fill: false
                                },
                                {
                                    label: 'Pessimistic Scenario',
                                    data: [100, 92, 85, 78, 70, 65, 60],
                                    borderColor: AppConfig.colors.status.danger,
                                    fill: false
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    title: { display: true, text: 'Water Availability Index' }
                                }
                            }
                        }
                    }
                };

                // Create all additional charts
                Object.entries(chartConfigs).forEach(([id, config]) => {
                    AppState.charts[id] = createChart(id, config);
                });
            }

            // Create Chart Helper Function
            function createChart(canvasId, config) {
                const canvas = document.getElementById(canvasId);
                if (!canvas) {
                    console.warn(`Canvas element #${canvasId} not found`);
                    return null;
                }

                const ctx = canvas.getContext('2d');
                return new Chart(ctx, config);
            }

            // Process Boreholes
            function processBoreholes() {
                // Clear existing layers
                if (AppState.layers.cluster) {
                    AppState.layers.cluster.clearLayers();
                }

                // Add boreholes to map
                AppState.filteredBoreholes.forEach(borehole => {
                    const { coordinates, properties } = borehole;
                    const status = properties.operation_ || 'unknown';
                    const yieldValue = parseFloat(properties.yield) || 0;
                    const depth = parseFloat(properties.well_depth) || 0;

                    // Determine color based on status
                    const color = AppConfig.colors.status[status] || AppConfig.colors.status.unknown;

                    // Create marker
                    const marker = L.circleMarker(coordinates, {
                        radius: 8,
                        fillColor: color,
                        color: '#ffffff',
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.8
                    });

                    // Create popup
                    const popupContent = `
                        <div style="min-width: 250px;">
                            <div style="background: ${color}; color: white; padding: 8px 12px; margin: -10px -10px 10px -10px; border-radius: 4px 4px 0 0;">
                                <strong>${properties.name}</strong>
                            </div>
                            <div style="padding: 8px 0;">
                                <div style="display: grid; grid-template-columns: 100px 1fr; gap: 6px; margin-bottom: 6px;">
                                    <strong>Status:</strong>
                                    <span style="color: ${color}; font-weight: 600;">${status.toUpperCase()}</span>
                                </div>
                                <div style="display: grid; grid-template-columns: 100px 1fr; gap: 6px; margin-bottom: 6px;">
                                    <strong>Yield:</strong>
                                    <span>${yieldValue.toFixed(1)} m/hr</span>
                                </div>
                                <div style="display: grid; grid-template-columns: 100px 1fr; gap: 6px; margin-bottom: 6px;">
                                    <strong>Depth:</strong>
                                    <span>${depth} m</span>
                                </div>
                                <div style="display: grid; grid-template-columns: 100px 1fr; gap: 6px;">
                                    <strong>Locality:</strong>
                                    <span>${properties.locality || 'Unknown'}</span>
                                </div>
                            </div>
                        </div>
                    `;

                    marker.bindPopup(popupContent);
                    AppState.layers.cluster.addLayer(marker);
                });
            }

            // Update Statistics
            function updateStatistics() {
                const stats = {
                    totalBoreholes: AppState.filteredBoreholes.length,
                    functionalCount: 0,
                    nonFunctionalCount: 0,
                    needsRepairCount: 0,
                    abandonedCount: 0,
                    dryCount: 0,
                    totalYield: 0,
                    totalDepth: 0,
                    averageYield: 0,
                    averageDepth: 0,
                    criticalBoreholes: 0,
                    peopleServed: 0
                };

                // Depth-Yield correlation data
                const depthYieldData = [];

                AppState.filteredBoreholes.forEach(borehole => {
                    const props = borehole.properties;
                    const yieldValue = parseFloat(props.yield) || 0;
                    const depth = parseFloat(props.well_depth) || 0;
                    const status = props.operation_ || 'unknown';

                    // Count by status
                    switch (status) {
                        case 'functional':
                            stats.functionalCount++;
                            break;
                        case 'non-functional':
                            stats.nonFunctionalCount++;
                            break;
                        case 'needs-repair':
                            stats.needsRepairCount++;
                            break;
                        case 'abandoned':
                            stats.abandonedCount++;
                            break;
                        case 'dry':
                            stats.dryCount++;
                            break;
                    }

                    // Sum totals
                    stats.totalYield += yieldValue;
                    stats.totalDepth += depth;

                    // Count critical (dry or very low yield)
                    if (yieldValue === 0) {
                        stats.criticalBoreholes++;
                    }

                    // Add to correlation data
                    if (yieldValue > 0 && depth > 0) {
                        depthYieldData.push({ x: depth, y: yieldValue });
                    }
                });

                // Calculate averages
                if (stats.totalBoreholes > 0) {
                    stats.averageYield = stats.totalYield / stats.totalBoreholes;
                    stats.averageDepth = stats.totalDepth / stats.totalBoreholes;
                }

                // Calculate people served (assume 20L/person/day, 8 hours operation)
                stats.peopleServed = Math.floor((stats.totalYield * 8 * 1000) / 20);

                // Update correlation chart
                if (AppState.charts.depthYield) {
                    AppState.charts.depthYield.data.datasets[0].data = depthYieldData;
                    AppState.charts.depthYield.update();
                }

                AppState.statistics = stats;
            }

            // Update UI
            function updateUI() {
                const stats = AppState.statistics;

                // Update main stats
                updateElementText('total-boreholes', stats.totalBoreholes);
                updateElementText('functional-rate', stats.totalBoreholes > 0 ?
                    `${Math.round((stats.functionalCount / stats.totalBoreholes) * 100)}%` : '0%');
                updateElementText('avg-yield', stats.averageYield.toFixed(1));
                updateElementText('avg-depth', stats.averageDepth.toFixed(0));
                updateElementText('people-served', stats.peopleServed.toLocaleString());
                updateElementText('critical-boreholes', stats.criticalBoreholes);

                // Update sidebar
                updateElementText('sidebar-total', stats.totalBoreholes);
                updateElementText('sidebar-functional', stats.totalBoreholes > 0 ?
                    `${Math.round((stats.functionalCount / stats.totalBoreholes) * 100)}%` : '0%');
                updateElementText('sidebar-yield', `${stats.averageYield.toFixed(1)} m/hr`);
                updateElementText('sidebar-depth', `${stats.averageDepth.toFixed(0)} m`);

                // Update last updated
                updateElementText('last-updated', new Date().toLocaleTimeString());

                // Update analysis metrics
                updateAnalysisMetrics();

                // Update charts
                updateCharts();

                // Update table
                updateTable();
            }

            // Update Analysis Metrics
            function updateAnalysisMetrics() {
                const stats = AppState.statistics;

                // Calculate additional metrics
                const operationalEfficiency = stats.totalBoreholes > 0 ?
                    Math.round((stats.functionalCount / stats.totalBoreholes) * 100) : 0;
                const yieldVariance = calculateYieldVariance();
                const successRate = calculateSuccessRate();

                // Update analysis metrics
                updateElementText('analysis-operational-efficiency', `${operationalEfficiency}%`);
                updateElementText('analysis-yield-variance', `${yieldVariance}%`);
                updateElementText('analysis-success-rate', `${successRate}%`);

                // Update matrix values
                updateElementText('matrix-yield-classification',
                    AppState.filteredBoreholes.filter(b => parseFloat(b.properties.yield) > 20).length);
                updateElementText('matrix-deep-boreholes',
                    AppState.filteredBoreholes.filter(b => parseFloat(b.properties.well_depth) > 100).length);
                updateElementText('matrix-recent-boreholes',
                    AppState.filteredBoreholes.filter(b => {
                        const year = new Date(b.properties.drilling_e).getFullYear();
                        return year >= 2019;
                    }).length);
            }

            // Calculate Yield Variance
            function calculateYieldVariance() {
                const yields = AppState.filteredBoreholes
                    .map(b => parseFloat(b.properties.yield) || 0)
                    .filter(y => y > 0);

                if (yields.length === 0) return 0;

                const mean = yields.reduce((a, b) => a + b, 0) / yields.length;
                const variance = yields.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / yields.length;
                const stdDev = Math.sqrt(variance);
                const cv = (stdDev / mean) * 100;

                return Math.round(cv);
            }

            // Calculate Success Rate
            function calculateSuccessRate() {
                const total = AppState.filteredBoreholes.length;
                const successful = AppState.filteredBoreholes.filter(b => {
                    const yield = parseFloat(b.properties.yield) || 0;
                    return yield > 5; // Consider boreholes with >5 m/hr as successful
                }).length;

                return total > 0 ? Math.round((successful / total) * 100) : 0;
            }

            // Update Charts
            function updateCharts() {
                const stats = AppState.statistics;

                // Update status chart
                if (AppState.charts.status) {
                    AppState.charts.status.data.datasets[0].data = [
                        stats.functionalCount,
                        stats.nonFunctionalCount,
                        stats.needsRepairCount,
                        stats.abandonedCount,
                        stats.dryCount
                    ];
                    AppState.charts.status.update();
                }

                // Update yield distribution chart
                if (AppState.charts.yield) {
                    const yieldRanges = [0, 5, 10, 20, 30, 50];
                    const counts = new Array(yieldRanges.length).fill(0);

                    AppState.filteredBoreholes.forEach(borehole => {
                        const yieldValue = parseFloat(borehole.properties.yield) || 0;
                        for (let i = 0; i < yieldRanges.length; i++) {
                            if (yieldValue < yieldRanges[i]) {
                                counts[i]++;
                                break;
                            }
                        }
                        if (yieldValue >= yieldRanges[yieldRanges.length - 1]) {
                            counts[counts.length - 1]++;
                        }
                    });

                    AppState.charts.yield.data.datasets[0].data = counts;
                    AppState.charts.yield.update();
                }
            }

            // Update Table
            function updateTable() {
                const tableBody = document.getElementById('table-body');
                if (!tableBody) return;

                tableBody.innerHTML = '';

                AppState.filteredBoreholes.slice(0, 10).forEach((borehole, index) => {
                    const props = borehole.properties;
                    const status = props.operation_ || 'unknown';
                    const yieldValue = parseFloat(props.yield) || 0;
                    const depth = parseFloat(props.well_depth) || 0;
                    const waterLevel = parseFloat(props.water_rest) || 0;
                    const year = props.drilling_e ? new Date(props.drilling_e).getFullYear() : 'Unknown';
                    const statusColor = AppConfig.colors.status[status] || AppConfig.colors.status.unknown;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td><strong>${props.name}</strong></td>
                        <td>${props.locality || 'Unknown'}</td>
                        <td>
                            <span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background-color: ${statusColor}; margin-right: 6px;"></span>
                            ${status.replace('-', ' ').toUpperCase()}
                        </td>
                        <td>${depth.toFixed(0)}</td>
                        <td>${yieldValue.toFixed(1)}</td>
                        <td>${waterLevel.toFixed(1)}</td>
                        <td>${year}</td>
                        <td>
                            <button class="btn btn-sm btn-outline" onclick="viewBoreholeOnMap(${borehole.coordinates[0]}, ${borehole.coordinates[1]})">
                                <i class="fas fa-map-marker-alt"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" onclick="showBoreholeDetails(${index})">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </td>
                    `;

                    tableBody.appendChild(row);
                });

                // Update table info
                const tableInfo = document.getElementById('table-info');
                if (tableInfo) {
                    tableInfo.textContent = `Showing 1-${Math.min(10, AppState.filteredBoreholes.length)} of ${AppState.filteredBoreholes.length} records`;
                }
            }

            // Initialize Event Listeners
            function initializeEventListeners() {
                // Page Navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = item.dataset.page;
                        switchPage(page);
                    });
                });

                // Tab Navigation
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabId = tab.dataset.tab;
                        switchTab(tabId);
                    });
                });

                // Filter Controls
                const applyFiltersBtn = document.getElementById('apply-filters');
                if (applyFiltersBtn) {
                    applyFiltersBtn.addEventListener('click', applyFilters);
                } else {
                    console.warn('Apply filters button not found');
                }

                const resetFiltersBtn = document.getElementById('reset-filters');
                if (resetFiltersBtn) {
                    resetFiltersBtn.addEventListener('click', resetFilters);
                }

                // Admin Level Selector
                const adminLevelSelect = document.getElementById('admin-level-select');
                if (adminLevelSelect) {
                    adminLevelSelect.addEventListener('change', function (e) {
                        AppState.currentAdminLevel = this.value;
                        updateAdminUnitDropdown();
                        displayAdminBoundaries(this.value);
                        showNotification(`Switched to ${this.value === 'county' ? 'County' : 'Sub-County'} level`, 'info');
                    });
                } else {
                    console.warn('Admin level select not found');
                }

                // Admin Unit Filter
                const adminUnitFilter = document.getElementById('admin-unit-filter');
                if (adminUnitFilter) {
                    adminUnitFilter.addEventListener('change', function (e) {
                        const selectedUnit = this.value;
                        highlightAdminUnit(selectedUnit);
                        filterByAdminUnit(selectedUnit);
                    });
                }

                // Refresh Data
                const refreshDataBtn = document.getElementById('refresh-data');
                if (refreshDataBtn) {
                    refreshDataBtn.addEventListener('click', () => {
                        showLoading('Refreshing data...');
                        setTimeout(() => {
                            processBoreholes();
                            updateStatistics();
                            updateUI();
                            hideLoading();
                            showNotification('Data refreshed successfully', 'success');
                        }, 1000);
                    });
                }

                // Map Controls
                const resetViewBtn = document.getElementById('reset-view');
                if (resetViewBtn) {
                    resetViewBtn.addEventListener('click', () => {
                        AppState.map.setView(AppConfig.map.center, AppConfig.map.zoom);
                    });
                }

                // Export Table
                const exportTableBtn = document.getElementById('export-table');
                if (exportTableBtn) {
                    exportTableBtn.addEventListener('click', exportTableToCSV);
                }

                // Analysis Card Clicks
                document.querySelectorAll('.analysis-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        if (!e.target.closest('button')) {
                            const layer = card.dataset.layer;
                            if (layer) {
                                showNotification(`Opening ${layer} analysis`, 'info');
                            }
                        }
                    });
                });

                // Base Map Selection
                document.querySelectorAll('[data-basemap]').forEach(button => {
                    button.addEventListener('click', () => {
                        const basemap = button.dataset.basemap;
                        switchBaseMap(basemap);
                    });
                });

                // Close Info Panel
                const closePanelBtn = document.getElementById('close-panel');
                if (closePanelBtn) {
                    closePanelBtn.addEventListener('click', () => {
                        const infoPanel = document.getElementById('info-panel');
                        if (infoPanel) {
                            infoPanel.style.display = 'none';
                        }
                    });
                }

                // Toggle Legend
                const toggleLegendBtn = document.getElementById('toggle-legend');
                if (toggleLegendBtn) {
                    toggleLegendBtn.addEventListener('click', () => {
                        const legend = document.getElementById('map-legend');
                        if (legend) {
                            legend.style.display = legend.style.display === 'none' ? 'block' : 'none';
                        }
                    });
                }

                // Clear Filters Button
                const clearFiltersBtn = document.getElementById('clear-filters');
                if (clearFiltersBtn) {
                    clearFiltersBtn.addEventListener('click', resetFilters);
                }

                console.log('Event listeners initialized');
            }

            // Filter by Administrative Unit
            function filterByAdminUnit(unitCode) {
                if (unitCode === 'all') {
                    // Reset to all boreholes
                    AppState.filteredBoreholes = [...AppState.boreholes];
                    showNotification('Showing all boreholes', 'info');
                } else {
                    // For demonstration, filter by locality
                    // In a real application, you would perform spatial filtering
                    const adminUnits = AppState.currentAdminLevel === 'county'
                        ? AppState.adminUnits.counties
                        : AppState.adminUnits.subcounties;

                    const unit = adminUnits.find(u => u.code === unitCode || u.id.toString() === unitCode);

                    if (unit) {
                        // Simple filtering by name (for demonstration)
                        // In reality, you would check if borehole coordinates are within the boundary
                        AppState.filteredBoreholes = AppState.boreholes.filter(borehole => {
                            const locality = borehole.properties.locality || '';
                            const admin4 = borehole.properties.admin_4 || '';

                            // Check if locality name contains unit name (simple demo)
                            const unitNamePart = unit.name.toLowerCase().split(' ')[0];
                            return locality.toLowerCase().includes(unitNamePart) ||
                                admin4.toLowerCase().includes(unitNamePart);
                        });

                        showNotification(`Filtered to ${AppState.filteredBoreholes.length} boreholes in ${unit.name}`, 'info');
                    } else {
                        AppState.filteredBoreholes = [...AppState.boreholes];
                        showNotification('Unit not found, showing all boreholes', 'warning');
                    }
                }

                // Reprocess and update
                processBoreholes();
                updateStatistics();
                updateUI();
            }

            // Switch Page
            function switchPage(page) {
                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.page === page) {
                        item.classList.add('active');
                    }
                });

                // Update page title and description
                const pageConfig = AppConfig.pages[page];
                if (pageConfig) {
                    const pageTitle = document.getElementById('page-title');
                    const pageDescription = document.getElementById('page-description');

                    if (pageTitle) pageTitle.textContent = pageConfig.title;
                    if (pageDescription) pageDescription.textContent = pageConfig.description;
                }

                // Hide all pages
                document.querySelectorAll('.page-content').forEach(content => {
                    content.classList.remove('active');
                });

                // Show selected page
                const pageElement = document.getElementById(`${page}-page`);
                if (pageElement) {
                    pageElement.classList.add('active');
                }

                // Reset to map tab for dashboard
                if (page === 'dashboard') {
                    switchTab('map');
                }

                showNotification(`Switched to ${pageConfig?.title || page}`, 'info');
            }

            // Switch Tab
            function switchTab(tabId) {
                // Update active tab
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.dataset.tab === tabId) {
                        tab.classList.add('active');
                    }
                });

                // Hide all tab contents
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                // Show selected tab content
                const tabContent = document.getElementById(`${tabId}-tab`);
                if (tabContent) {
                    tabContent.classList.add('active');
                }

                AppState.currentTab = tabId;
            }

            // Switch Base Map
            function switchBaseMap(basemap) {
                // Remove current basemap
                Object.values(AppConfig.basemaps).forEach(layer => {
                    if (AppState.map.hasLayer(layer)) {
                        AppState.map.removeLayer(layer);
                    }
                });

                // Add new basemap
                if (AppConfig.basemaps[basemap]) {
                    AppConfig.basemaps[basemap].addTo(AppState.map);
                }

                // Update active button
                document.querySelectorAll('[data-basemap]').forEach(button => {
                    button.classList.remove('active');
                    if (button.dataset.basemap === basemap) {
                        button.classList.add('active');
                    }
                });
            }

            // Apply Filters
            function applyFilters() {
                const statusCheckboxes = document.querySelectorAll('input[name="status"]:checked');
                const selectedStatuses = Array.from(statusCheckboxes).map(cb => cb.value);

                const yieldMax = parseInt(document.getElementById('yield-filter').value) || 50;
                const depthMax = parseInt(document.getElementById('depth-filter').value) || 200;
                const yearFilter = document.getElementById('year-filter')?.value || 'all';

                AppState.filteredBoreholes = AppState.boreholes.filter(borehole => {
                    const props = borehole.properties;
                    const status = props.operation_ || 'unknown';
                    const yieldValue = parseFloat(props.yield) || 0;
                    const depth = parseFloat(props.well_depth) || 0;
                    const year = props.drilling_e ? new Date(props.drilling_e).getFullYear() : 0;

                    // Status filter
                    if (selectedStatuses.length > 0 && !selectedStatuses.includes(status)) {
                        return false;
                    }

                    // Yield filter
                    if (yieldValue > yieldMax) {
                        return false;
                    }

                    // Depth filter
                    if (depth > depthMax) {
                        return false;
                    }

                    // Year filter
                    if (yearFilter !== 'all') {
                        const currentYear = new Date().getFullYear();
                        if (yearFilter === 'recent' && year < currentYear - 5) {
                            return false;
                        } else if (yearFilter === 'medium' && (year < currentYear - 10 || year >= currentYear - 5)) {
                            return false;
                        } else if (yearFilter === 'old' && year >= currentYear - 10) {
                            return false;
                        }
                    }

                    return true;
                });

                // Update filters display
                const yieldValue = document.getElementById('yield-value');
                const depthValue = document.getElementById('depth-value');

                if (yieldValue) yieldValue.textContent = `0 - ${yieldMax} m/hr`;
                if (depthValue) depthValue.textContent = `0 - ${depthMax} m`;

                // Reprocess and update
                processBoreholes();
                updateStatistics();
                updateUI();

                showNotification('Filters applied successfully', 'success');
            }

            // Reset Filters
            function resetFilters() {
                // Reset all checkboxes
                document.querySelectorAll('input[name="status"]').forEach(cb => {
                    cb.checked = true;
                });

                // Reset sliders
                document.getElementById('yield-filter').value = 50;
                document.getElementById('depth-filter').value = 200;

                // Reset year filter
                const yearFilter = document.getElementById('year-filter');
                if (yearFilter) yearFilter.value = 'all';

                // Reset admin unit filter
                const adminUnitFilter = document.getElementById('admin-unit-filter');
                if (adminUnitFilter) adminUnitFilter.value = 'all';

                // Reset filter displays
                const yieldValue = document.getElementById('yield-value');
                const depthValue = document.getElementById('depth-value');

                if (yieldValue) yieldValue.textContent = '0 - 50 m/hr';
                if (depthValue) depthValue.textContent = '0 - 200 m';

                // Reset filtered data
                AppState.filteredBoreholes = [...AppState.boreholes];

                // Remove highlighted boundary
                AppState.layers.highlightedBoundary.clearLayers();

                // Reprocess and update
                processBoreholes();
                updateStatistics();
                updateUI();

                showNotification('All filters reset', 'info');
            }

            // Export Table to CSV
            function exportTableToCSV() {
                let csv = 'ID,Name,Location,Status,Depth (m),Yield (m/hr),Water Level (m),Year\n';

                AppState.filteredBoreholes.forEach((borehole, index) => {
                    const props = borehole.properties;
                    const status = props.operation_ || 'unknown';
                    const yieldValue = parseFloat(props.yield) || 0;
                    const depth = parseFloat(props.well_depth) || 0;
                    const waterLevel = parseFloat(props.water_rest) || 0;
                    const year = props.drilling_e ? new Date(props.drilling_e).getFullYear() : 'Unknown';

                    csv += `${index + 1},"${props.name}","${props.locality || 'Unknown'}",${status},${depth},${yieldValue},${waterLevel},${year}\n`;
                });

                // Create download link
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'boreholes_data.csv';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);

                showNotification('Data exported to CSV', 'success');
            }

            // View Borehole on Map
            window.viewBoreholeOnMap = function (lat, lng) {
                AppState.map.setView([lat, lng], 14);
                showNotification('Centered on borehole location', 'info');
            };

            // Show Borehole Details
            window.showBoreholeDetails = function (index) {
                const borehole = AppState.filteredBoreholes[index];
                if (borehole) {
                    const props = borehole.properties;
                    const status = props.operation_ || 'unknown';
                    const statusColor = AppConfig.colors.status[status] || AppConfig.colors.status.unknown;

                    const details = `
                        <div class="info-section">
                            <h6>Borehole Details</h6>
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-label">Name</div>
                                    <div class="info-value">${props.name}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Status</div>
                                    <div class="info-value" style="color: ${statusColor}">${status.toUpperCase()}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Coordinates</div>
                                    <div class="info-value">${borehole.coordinates[0].toFixed(4)}, ${borehole.coordinates[1].toFixed(4)}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Yield</div>
                                    <div class="info-value">${parseFloat(props.yield || 0).toFixed(1)} m/hr</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Depth</div>
                                    <div class="info-value">${parseFloat(props.well_depth || 0)} m</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Water Level</div>
                                    <div class="info-value">${parseFloat(props.water_rest || 0).toFixed(1)} m</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Locality</div>
                                    <div class="info-value">${props.locality || 'Unknown'}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Completion Date</div>
                                    <div class="info-value">${props.drilling_e || 'Unknown'}</div>
                                </div>
                            </div>
                        </div>
                    `;

                    showInfoPanel('Borehole Details', details);
                }
            };

            // Show Info Panel
            function showInfoPanel(title, content) {
                const panelTitle = document.getElementById('panel-title');
                const panelContent = document.getElementById('panel-content');
                const infoPanel = document.getElementById('info-panel');

                if (panelTitle) panelTitle.textContent = title;
                if (panelContent) panelContent.innerHTML = content;
                if (infoPanel) {
                    infoPanel.style.display = 'block';
                }
            }

            // Utility Functions
            function updateElementText(elementId, text) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = text;
                }
            }

            function showLoading(message) {
                AppState.isLoading = true;
                const loadingOverlay = document.getElementById('map-loading');
                const loadingText = document.getElementById('loading-text');

                if (loadingOverlay) {
                    loadingOverlay.style.display = 'flex';
                    loadingOverlay.style.zIndex = '1000';
                }
                if (loadingText) loadingText.textContent = message || 'Loading...';
            }

            function hideLoading() {
                AppState.isLoading = false;
                setTimeout(() => {
                    const loadingOverlay = document.getElementById('map-loading');
                    if (loadingOverlay) {
                        loadingOverlay.style.display = 'none';
                    }
                }, 500);
            }

            function showNotification(message, type = 'info') {
                // Remove existing notifications
                const existingNotifications = document.querySelectorAll('.notification');
                existingNotifications.forEach(notification => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                });

                // Create notification
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;

                let icon = 'info-circle';
                if (type === 'success') icon = 'check-circle';
                else if (type === 'error') icon = 'exclamation-circle';
                else if (type === 'warning') icon = 'exclamation-triangle';

                notification.innerHTML = `
                    <i class="fas fa-${icon}"></i>
                    <span>${message}</span>
                `;

                document.body.appendChild(notification);

                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 5000);
            }

            function showError(message) {
                showNotification(message, 'error');
            }

            // Initialize the application
            console.log('Comprehensive analysis system initialized');
        </script>
</body>

</html>